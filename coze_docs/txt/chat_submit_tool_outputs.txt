https://www.coze.cn/open/docs/developer_guides/chat_submit_tool_outputs

扣子
创建
主页
项目开发
资源库
任务中心
效果评测
空间配置
模板商店
插件商店
作品社区
API 管理
文档中心
目录
取消固定
使用指南
开发指南
API 和 SDK
API 参考
API 介绍
更新日志
准备工作
API Playground
鉴权
鉴权方式概述
添加个人访问令牌
添加服务访问令牌
OAuth 应用管理
通过示例文件体验 OAuth 授权流程
OAuth 授权码授权
OAuth PKCE
OAuth 设备授权
OAuth JWT 授权（开发者）
OAuth JWT 授权（渠道场景）
OAuth JWT 授权（跨账号授权场景）
OAuth JWT 授权（企业特权应用）
OAuth 授权（多人协作场景）
鉴权常见问题
智能体和应用
创建智能体
更新智能体
发布智能体
查看智能体列表
查看智能体配置
开启或关闭智能体多人协作
添加智能体的协作者
添加应用的协作者
删除智能体的协作者
删除应用的协作者
查看智能体版本列表
复制资源
查询资源复制的结果
下架智能体
Bot object
查看应用列表
智能体发布回调事件
智能体删除回调事件
智能体下架回调事件
工作空间
创建工作空间
查看空间列表
修改工作空间基本信息
查看空间成员列表
批量邀请用户加入空间
批量移除空间中的用户
文件夹
查询文件夹列表
查询文件夹详情
企业/组织
成员管理（火山 API）
添加团队/企业成员
修改企业员工的角色
移除团队/企业成员
创建组织
修改组织基本信息
查询组织列表
添加组织成员
查询组织成员列表
修改组织成员角色
移除组织成员
会话与消息
创建会话
查看会话信息
查看会话列表
更新会话名称
删除会话
清除上下文
创建消息
查看消息列表
查看消息详情
修改消息
删除消息
消息 type 说明
提交消息评价
删除消息评价
对话
发起对话
查看对话详情
查看对话消息详情
提交工具执行结果
取消进行中的对话
工作流
执行工作流
执行工作流（流式响应）
恢复运行工作流（流式响应）
恢复运行工作流
查询工作流异步运行结果
执行对话流
查询输出节点的执行结果
查询工作流列表
查询工作流基本信息
查询工作流的版本列表
开启或关闭工作流多人协作
添加工作流协作者
删除工作流协作者
文件
上传文件
查看文件详情
智能音视频
ASR、TTS 与音色
查看音色列表
语音合成
语音识别
复刻音色
RTC 语音
创建房间
Realtime 上行事件
Realtime 下行事件
Realtime 事件错误码
WebSocket 语音
双向流式语音识别
双向流式语音识别事件
双向流式语音合成
双向流式语音合成事件
双向流式语音对话
双向流式对话上行事件
双向流式对话下行事件
声纹识别
创建声纹组
查询声纹组列表
更新声纹组信息
删除声纹组
创建声纹
更新声纹
查询声纹列表
删除声纹
声纹特征比对
知识库
创建知识库
查看知识库列表
修改知识库信息
删除知识库
创建知识库文件
修改知识库文件
查看知识库文件列表
查看知识库文件上传进度
更新知识库图片描述
查看知识库图片列表
删除知识库文件
插件
查询付费插件列表
查询插件分类
查询插件详情
批量查询插件信息
调用插件工具
申请插件扩容回调事件
插件扩容到期回调事件
变量
设置用户变量的值
获取用户变量的值
渠道
更新审核结果
添加发布平台
绑定设备
终端用户配额管控
创建终端用户权益额度
查询终端用户的权益配额
更新终端用户的权益额度
账单与权益
导出终端用户账单
查询账单文件
查询套餐权益
账单推送回调事件
回调
创建回调应用
修改回调应用
查询回调应用列表
删除回调应用
订阅回调事件
查询已订阅的事件
取消订阅事件
历史版本接口
【Deprecated】查看已发布智能体列表
【Deprecated】获取已发布智能体的配置
错误码
API 常见问题
模型能力差异
最佳实践
通过对话接口获取智能体回复
错误码 4100/4101 问题排查
如何实现会话隔离
升级企业/团队版后更新 API 授权
SDK 参考
Chat SDK
Chat SDK 概述
安装并使用 Chat SDK
Chat SDK 发布历史
（历史版本）Chat SDK
Chat SDK 常见问题
Python SDK
Python SDK 概述
安装 Python SDK
配置访问密钥
快速开始
Node.js SDK
Node.js SDK 概述
安装 Node.js SDK
配置访问密钥
快速开始
Java SDK
Java SDK 概述
安装 Java SDK
配置访问密钥
快速开始
Go SDK
Go SDK 概述
安装 Go SDK
配置访问密钥
快速开始
Web SDK
安装并使用 Web SDK
Card SDK
安装并使用 Card SDK
实践教程
扣子空间
扣子罗盘
客户案例
定价与购买
目录
大纲
提交工具执行结果
调用此接口提交工具执行的结果。​
接口说明​
你可以将需要客户端执行的操作定义为插件，对话中如果触发这个插件，流式 event 响应信息会提示“conversation.chat.requires_action”，此时需要执行客户端的操作后，通过此接口提交插件执行后的结果。​
说明
调用发起对话 API 时，auto_save_history 参数需要设置为 true，否则调用本 API 提交工具执行结果时会提示 5000 错误。​
仅触发了端插件的对话需要调用此接口提交执行结果。端插件为非扣子服务端执行的插件，需要开发者自行执行任务后提交结果，通常用于 IoT 等设备控制场景。详细说明可参考通过 API 使用端插件。​
​
基础信息​
​
请求方式​
	
POST​


请求地址​
	
​
 https://api.coze.cn/v3/chat/submit_tool_outputs​
​


权限​
	
submitToolChat​
确保调用该接口使用的个人令牌开通了 submitToolChat 权限，详细信息参考​鉴权方式概述。​


接口说明​
	
调用接口提交工具执行结果。​


​
Header​
​
参数​
	
取值​
	
说明​


Authorization​
	
Bearer $Access_Token​
	
用于验证客户端身份的访问令牌。你可以在扣子平台中生成访问令牌，详细信息，参考​准备工作。​


Content-Type​
	
application/json​
	
解释请求正文的方式。​


​
​
​
Query​
​
参数​
	
类型​
	
是否必选​
	
示例​
	
说明​


conversation_id​
	
String​
	
必选​
	
748348012449138***​
	
Conversation ID，即会话的唯一标识。可以在发起对话接口 Response 中查看 id 字段，如果是流式响应，则在 Response 的 chat 事件中查看 id 字段。​


chat_id​
	
String​
	
必选​
	
738137187639794***​
	
Chat ID，即对话的唯一标识。可以在发起对话接口 Response 中查看 id 字段，如果是流式响应，则在 Response 的 chat 事件中查看 id 字段。​


​
Body​
​
参数​
	
类型​
	
是否必选​
	
示例​
	
说明​


tool_outputs​
	
Array of Object​
	
必选​
	
[{"tool_call_id":"BUJJF0dAQ0NAEBVeQkVKEV5HFURFXhFCEhFeFxdHShcSQEtFSxY****","output":"Tokyo"}]​
	
工具执行结果。详细说明可参考 ​ToolOutput Object。​


stream​
	
Boolean​
	
必选​
	
true​
	
是否开启流式响应。​
true：填充之前对话中的上下文，继续流式响应。​
false：（默认）非流式响应，仅回复对话的基本信息。​


​
ToolOutput Object​
​
参数​
	
类型​
	
是否必选​
	
说明​


tool_call_id​
	
String​
	
必选​
	
上报运行结果的 ID。你可以在​发起对话接口响应的 tool_calls 字段下查看此 ID。​


output​
	
String​
	
必选​
	
工具的执行结果。​
如果端插件工具某个请求参数包含 Image 等文件类型，可以先调用​上传文件 API 获取 file_id，然后调用此 API 在 output 中以序列化之后的 JSON 格式传入 file_id。例如入参 file 为文件类型，文件的 file_id 为 12345，则 output 可以指定为 "output": "{\"file\": \"12345\"}"。​


​
返回结果​
流式响应​
在流式响应中，服务端不会一次性发送所有数据，而是以数据流的形式逐条发送数据给客户端，数据流中包含对话过程中触发的各种事件（event），直至处理完毕或处理中断。处理结束后，服务端会通过 conversation.message.completed 事件返回拼接后完整的模型回复信息。各个事件的说明可参考流式响应事件。​
流式响应允许客户端在接收到完整的数据流之前就开始处理数据，例如在对话界面实时展示智能体的回复内容，减少客户端等待模型完整回复的时间。​
流式响应的整体流程如下：​
流式响应流程
流式响应示例
​
######### 整体概览 （chat, MESSAGE 两级）​
# chat - 开始​
# chat - 处理中​
#   MESSAGE - 知识库召回​
#   MESSAGE - function_call​
#   MESSAGE - tool_output​
#   MESSAGE - answer is card​
#   MESSAGE - answer is normal text​
#   MESSAGE - 多 answer 的情况下，会继续有 message.delta​
#   MESSAGE - verbose （多 answer、Multi-agent 跳转等场景）​
#   MESSAGE - suggestion​
# chat - 完成​
# 流结束 event: done​
#########​
​
​
返回的事件消息体结构如下：​
​
参数​
	
类型​
	
说明​


event​
	
String​
	
当前流式返回的数据包事件。详细说明可参考 流式响应事件。​


data​
	
Object​
	
消息内容。其中，chat 事件和 message 事件的格式不同。​
chat 事件中，data 为 Chat Object。​
message 事件中，data 为 Message Object。​


​
流式响应事件​
​
事件（event）名称​
	
说明​


conversation.chat.created​
	
创建对话的事件，表示对话开始。​


conversation.chat.in_progress​
	
服务端正在处理对话。​


conversation.message.delta​
	
增量消息，通常是 type=answer 时的增量消息。​


conversation.message.completed​
	
message 已回复完成。此时流式包中带有所有 message.delta 的拼接结果，且每个消息均为 completed 状态。​


conversation.chat.completed​
	
对话完成。​


conversation.chat.failed​
	
此事件用于标识对话失败。​


conversation.chat.requires_action​
	
对话中断，需要使用方上报工具的执行结果。​


error​
	
流式响应过程中的错误事件。关于 code 和 msg 的详细说明，可参考​错误码。​


done​
	
本次会话的流式返回正常结束。​


​
非流式响应​
在非流式响应中，无论服务端是否处理完毕，立即发送响应消息。其中包括本次对话的 chat_id、状态等元数据信息，但不包括模型处理的最终结果。​
非流式响应不需要维持长连接，在场景实现上更简单，但通常需要客户端主动查询对话状态和消息详情才能得到完整的数据。你可以通过接口​查看对话详情确认本次对话处理结束后，再调用​查看对话消息详情接口查看模型回复等完整响应内容。流程如下：​
​
​
​
​
​
非流式响应的结构如下：​
​
参数​
	
类型​
	
说明​


data​
	
Object​
	
本次对话的基本信息。详细说明可参考 Chat Object。​


code​
	
Integer​
	
状态码。​
0 代表调用成功。​


msg​
	
String​
	
状态信息。API 调用失败时可通过此字段查看详细错误信息。​


​
​
​
Chat Object​
​
参数​
	
类型​
	
是否可选​
	
说明​


id​
	
String​
	
必填​
	
对话 ID，即对话的唯一标识。​


conversation_id​
	
String​
	
必填​
	
会话 ID，即会话的唯一标识。​


bot_id​
	
String​
	
必填​
	
要进行会话聊天的智能体 ID。​


created_at​
	
Integer​
	
选填​
	
对话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。​


completed_at​
	
Integer​
	
选填​
	
对话结束的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。​


failed_at​
	
Integer​
	
选填​
	
对话失败的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。​


meta_data​
	
Map<String,String>​
	
选填​
	
发起对话时的附加消息，用于传入使用方的自定义数据，查看对话详情时也会返回此附加消息。​
自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。​


last_error​
​
	
Object​
	
选填​
	
对话运行异常时，此字段中返回详细的错误信息，包括：​
Code：错误码。Integer 类型。0 表示成功，其他值表示失败。​
Msg：错误信息。String 类型。​
说明
对话正常运行时，此字段返回 null。​
suggestion 失败不会被标记为运行异常，不计入 last_error。​
​


status​
​
	
String​
	
必填​
	
对话的运行状态。取值为：​
created：对话已创建。​
in_progress：智能体正在处理中。​
completed：智能体已完成处理，本次对话结束。​
failed：对话失败。​
requires_action：对话中断，需要进一步处理。​
canceled：对话已取消。​


required_action​
	
Object​
	
选填​
	
需要运行的信息详情。​


» type​
	
String​
	
选填​
	
额外操作的类型，枚举值为 submit_tool_outputs。​


»submit_tool_outputs​
	
Object​
	
选填​
	
需要提交的结果详情，通过提交接口上传，并可以继续聊天​


»» tool_calls​
	
Array of Object​
	
选填​
	
具体上报信息详情。​


»»» id​
	
String​
	
选填​
	
上报运行结果的 ID。​


»»» type​
	
String​
	
选填​
	
工具类型，枚举值包括：​
function：待执行的方法，通常是端插件。触发端插件时会返回此枚举值。​
reply_message：待回复的选项。触发工作流问答节点时会返回此枚举值。​


»»» function​
	
Object​
	
选填​
	
执行方法 function 的定义。​


»»»» name​
	
String​
	
选填​
	
方法名。​


»»»» arguments​
	
String​
	
选填​
	
方法参数。​


usage​
	
Object​
	
选填​
	
Token 消耗的详细信息。实际的 Token 消耗以对话结束后返回的值为准。​


»token_count​
	
Integer​
	
选填​
	
本次对话消耗的 Token 总数，包括 input 和 output 部分的消耗。​


»output_count​
	
Integer​
	
选填​
	
output 部分消耗的 Token 总数。​


»input_count​
	
Integer​
	
选填​
	
input 部分消耗的 Token 总数。​


​
Chat Object 的示例如下：​
状态正常的对话
需要使用方额外处理的对话
​
{​
// 在 chat 事件里，data 字段中的 id 为 Chat ID，即会话 ID。​
    "id": "737662389258662****",​
    "conversation_id": "737554565555041****",​
    "bot_id": "736661612448078****",​
    "completed_at": 1717508113,​
    "last_error": {​
        "code": 0,​
        "msg": ""​
    },​
    "status": "completed",​
    "usage": {​
        "token_count": 6644,​
        "output_count": 766,​
        "input_count": 5878​
    }​
}​
​
​
​
​
Message Object​
​
参数​
	
类型​
	
说明​


id​
	
String​
	
Message ID，即消息的唯一标识。​


conversation_id​
	
String​
	
此消息所在的会话 ID。​


bot_id​
	
String​
	
编写此消息的智能体ID。此参数仅在对话产生的消息中返回。​


chat_id​
	
String​
	
Chat ID。此参数仅在对话产生的消息中返回。​


meta_data​
	
Map​
	
创建消息时的附加消息，获取消息时也会返回此附加消息。​


role​
	
String​
	
发送这条消息的实体。取值：​
user：代表该条消息内容是用户发送的。​
assistant：代表该条消息内容是智能体发送的。​


content​
	
String​
​
	
消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。​


content_type​
	
String​
	
消息内容的类型，取值包括：​
text：文本。​
object_string：多模态内容，即文本和文件的组合、文本和图片的组合。​
card：卡片。此枚举值仅在接口响应中出现，不支持作为入参。​


created_at​
	
Integer​
	
消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。​


updated_at​
	
Integer​
	
消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。​


type​
	
String​
	
消息类型。​
question：用户输入内容。​
answer：智能体返回给用户的消息内容，支持增量返回。如果工作流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。​
function_call：智能体对话过程中调用函数（function call）的中间结果。 ​
tool_output：调用工具 （function call）后返回的结果。​
tool_response：调用工具 （function call）后返回的结果。​
follow_up：如果在智能体上配置打开了用户问题建议开关，则会返回推荐问题相关的回复内容。​
verbose：多 answer 场景下，服务端会返回一个 verbose 包，对应的 content 为 JSON 格式，content.msg_type =generate_answer_finish 代表全部 answer 回复完成。​
说明
仅发起会话（v3）接口支持将此参数作为入参，且：​
如果 autoSaveHistory=true，type 支持设置为 question 或 answer。​
如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output/tool_response。​
其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。详细说明可参考​消息 type 说明。​
​


section_id​
	
String​
	
预留字段，仅在调用​发起对话 API 时的部分场景下返回，无需关注。​


​
​
​
示例​
请求示例​
​
curl --location --request POST 'https://api.coze.cn/v3/chat/submit_tool_outputs?chat_id=738137187639794****&conversation_id=738136585609548****' \​
--header 'Authorization: Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \​
--header 'Content-Type: application/json' \​
--data-raw '{​
    "tool_outputs":[​
        {​
            "tool_call_id":"BUJJF0dAQ0NAEBVeQkVKEV5HFURFXhFCEhFeFxdHShcSQEtFSxY****",​
            "output":"Tokyo"​
        }​
    ]​
}'​
​
返回示例​
​
{​
    "data":{​
        "id": "738137187639794****",​
        "conversation_id": "748348012449138***",​
        "bot_id": "22248012449138***",​
        "created_at": 1710348675,​
        "completed_at": 1710348675,​
        "last_error": null,​
        "meta_data": {},​
        "status": "completed",​
        "usage": {​
            "token_count": 3397,​
            "output_tokens": 1173,​
            "input_tokens": 2224​
        }​
    },​
    "code":0,​
    "msg":""​
}​
​
上一篇
查看对话消息详情
下一篇
取消进行中的对话
接口说明
基础信息
Header
Query
Body
ToolOutput Object
返回结果
流式响应
流式响应事件
非流式响应
Chat Object
Message Object
示例
请求示例
返回示例
rangeDom