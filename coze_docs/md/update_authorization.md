https://www.coze.cn/open/docs/developer_guides/update_authorization

# 扣子
创建
[主页](https://www.coze.cn/sign)[项目开发](https://www.coze.cn/sign)[资源库](https://www.coze.cn/sign)[任务中心](https://www.coze.cn/sign)[效果评测](https://www.coze.cn/sign)[空间配置](https://www.coze.cn/sign)
[模板商店](https://www.coze.cn/sign)[插件商店](https://www.coze.cn/sign)[作品社区](https://www.coze.cn/sign)[API 管理](https://www.coze.cn/open/playground)[文档中心](https://www.coze.cn/open/docs/guides)
目录取消固定
[使用指南](https://www.coze.cn/open/docs/guides)
[开发指南](https://www.coze.cn/open/docs/dev_how_to_guides)
[API 和 SDK](https://www.coze.cn/open/docs/developer_guides)
API 参考
[API 介绍](https://www.coze.cn/open/docs/developer_guides/coze_api_overview)[更新日志](https://www.coze.cn/open/docs/developer_guides/changelog)[准备工作](https://www.coze.cn/open/docs/developer_guides/preparation)[API Playground](https://www.coze.cn/open/docs/developer_guides/api_playground)
鉴权
[鉴权方式概述](https://www.coze.cn/open/docs/developer_guides/authentication)[添加个人访问令牌](https://www.coze.cn/open/docs/developer_guides/pat)[添加服务访问令牌](https://www.coze.cn/open/docs/developer_guides/service_token)[OAuth 应用管理](https://www.coze.cn/open/docs/developer_guides/oauth_apps)[通过示例文件体验 OAuth 授权流程](https://www.coze.cn/open/docs/developer_guides/ouath_demo)[OAuth 授权码授权](https://www.coze.cn/open/docs/developer_guides/oauth_code)[OAuth PKCE](https://www.coze.cn/open/docs/developer_guides/oauth_pkce)[OAuth 设备授权](https://www.coze.cn/open/docs/developer_guides/oauth_device_code)[OAuth JWT 授权（开发者）](https://www.coze.cn/open/docs/developer_guides/oauth_jwt)[OAuth JWT 授权（渠道场景）](https://www.coze.cn/open/docs/developer_guides/oauth_jwt_channel)[OAuth JWT 授权（跨账号授权场景）](https://www.coze.cn/open/docs/developer_guides/oauth_jwt_collaborate)[OAuth JWT 授权（企业特权应用）](https://www.coze.cn/open/docs/developer_guides/oauth_jwt_privilege)[OAuth 授权（多人协作场景）](https://www.coze.cn/open/docs/developer_guides/oauth_collaborate)[鉴权常见问题](https://www.coze.cn/open/docs/developer_guides/authentication_faq)
智能体和应用
[创建智能体](https://www.coze.cn/open/docs/developer_guides/create_bot)[更新智能体](https://www.coze.cn/open/docs/developer_guides/update_bot)[发布智能体](https://www.coze.cn/open/docs/developer_guides/publish_bot)[查看智能体列表](https://www.coze.cn/open/docs/developer_guides/bots_list_draft_published)[查看智能体配置](https://www.coze.cn/open/docs/developer_guides/get_metadata_draft_published)[开启或关闭智能体多人协作](https://www.coze.cn/open/docs/developer_guides/switch_bot_develop_mode)[添加智能体的协作者](https://www.coze.cn/open/docs/developer_guides/add_bot_collaborator)[添加应用的协作者](https://www.coze.cn/open/docs/developer_guides/add_app_collaborator)[删除智能体的协作者](https://www.coze.cn/open/docs/developer_guides/remove_bot_collaborator)[删除应用的协作者](https://www.coze.cn/open/docs/developer_guides/remove_app_collaborator)[查看智能体版本列表](https://www.coze.cn/open/docs/developer_guides/list_bot_versions)[复制资源](https://www.coze.cn/open/docs/developer_guides/copy_resource_task)[查询资源复制的结果](https://www.coze.cn/open/docs/developer_guides/query_resource_copy_execution_result)[下架智能体](https://www.coze.cn/open/docs/developer_guides/unpublish_agent)[Bot object](https://www.coze.cn/open/docs/developer_guides/bot_object)[查看应用列表](https://www.coze.cn/open/docs/developer_guides/published_apps_list)[智能体发布回调事件](https://www.coze.cn/open/docs/developer_guides/agent_callback_messages)[智能体删除回调事件](https://www.coze.cn/open/docs/developer_guides/agent_delete_callback_messages)[智能体下架回调事件](https://www.coze.cn/open/docs/developer_guides/agent_unpublished_callback_messages)
工作空间
[创建工作空间](https://www.coze.cn/open/docs/developer_guides/create_workspace)[查看空间列表](https://www.coze.cn/open/docs/developer_guides/list_workspace)[修改工作空间基本信息](https://www.coze.cn/open/docs/developer_guides/update_workspace_info)[查看空间成员列表](https://www.coze.cn/open/docs/developer_guides/list_space_member)[批量邀请用户加入空间](https://www.coze.cn/open/docs/developer_guides/add_space_member)[批量移除空间中的用户](https://www.coze.cn/open/docs/developer_guides/remove_space_member)
文件夹
[查询文件夹列表](https://www.coze.cn/open/docs/developer_guides/workspace_list_folder)[查询文件夹详情](https://www.coze.cn/open/docs/developer_guides/workspace_read_folder)
企业/组织
[成员管理（火山 API）](https://www.coze.cn/open/docs/developer_guides/create_coze_user)[添加团队/企业成员](https://www.coze.cn/open/docs/developer_guides/add_enterprise_member)[修改企业员工的角色](https://www.coze.cn/open/docs/developer_guides/update_enterprise_people)[移除团队/企业成员](https://www.coze.cn/open/docs/developer_guides/remove_enterprise_member)[创建组织](https://www.coze.cn/open/docs/developer_guides/create_organization)[修改组织基本信息](https://www.coze.cn/open/docs/developer_guides/update_organization_info)[查询组织列表](https://www.coze.cn/open/docs/developer_guides/list_organization)[添加组织成员](https://www.coze.cn/open/docs/developer_guides/add_organization_people)[查询组织成员列表](https://www.coze.cn/open/docs/developer_guides/list_organization_people)[修改组织成员角色](https://www.coze.cn/open/docs/developer_guides/update_organization_people)[移除组织成员](https://www.coze.cn/open/docs/developer_guides/remove_organization_member)
会话与消息
[创建会话](https://www.coze.cn/open/docs/developer_guides/create_conversation)[查看会话信息](https://www.coze.cn/open/docs/developer_guides/retrieve_conversation)[查看会话列表](https://www.coze.cn/open/docs/developer_guides/list_conversations)[更新会话名称](https://www.coze.cn/open/docs/developer_guides/edit_conversation)[删除会话](https://www.coze.cn/open/docs/developer_guides/delete_conversation)[清除上下文](https://www.coze.cn/open/docs/developer_guides/clear_conversation_context)[创建消息](https://www.coze.cn/open/docs/developer_guides/create_message)[查看消息列表](https://www.coze.cn/open/docs/developer_guides/list_message)[查看消息详情](https://www.coze.cn/open/docs/developer_guides/retrieve_message)[修改消息](https://www.coze.cn/open/docs/developer_guides/modify_message)[删除消息](https://www.coze.cn/open/docs/developer_guides/delete_message)[消息 type 说明](https://www.coze.cn/open/docs/developer_guides/message_type)[提交消息评价](https://www.coze.cn/open/docs/developer_guides/message_feedback)[删除消息评价](https://www.coze.cn/open/docs/developer_guides/delete_message_feedback)
对话
[发起对话](https://www.coze.cn/open/docs/developer_guides/chat_v3)[查看对话详情](https://www.coze.cn/open/docs/developer_guides/retrieve_chat)[查看对话消息详情](https://www.coze.cn/open/docs/developer_guides/list_chat_messages)[提交工具执行结果](https://www.coze.cn/open/docs/developer_guides/chat_submit_tool_outputs)[取消进行中的对话](https://www.coze.cn/open/docs/developer_guides/chat_cancel)
工作流
[执行工作流](https://www.coze.cn/open/docs/developer_guides/workflow_run)[执行工作流（流式响应）](https://www.coze.cn/open/docs/developer_guides/workflow_stream_run)[恢复运行工作流（流式响应）](https://www.coze.cn/open/docs/developer_guides/workflow_resume)[恢复运行工作流](https://www.coze.cn/open/docs/developer_guides/resume_workflow)[查询工作流异步运行结果](https://www.coze.cn/open/docs/developer_guides/workflow_history)[执行对话流](https://www.coze.cn/open/docs/developer_guides/workflow_chat)[查询输出节点的执行结果](https://www.coze.cn/open/docs/developer_guides/get_node_execute_history_response)[查询工作流列表](https://www.coze.cn/open/docs/developer_guides/get_workflow_list)[查询工作流基本信息](https://www.coze.cn/open/docs/developer_guides/get_workflow_info)[查询工作流的版本列表](https://www.coze.cn/open/docs/developer_guides/list_workflow_version)[开启或关闭工作流多人协作](https://www.coze.cn/open/docs/developer_guides/switch_workflow_develop_mode)[添加工作流协作者](https://www.coze.cn/open/docs/developer_guides/add_workflow_collaborator)[删除工作流协作者](https://www.coze.cn/open/docs/developer_guides/remove_workflow_collaborator)
文件
[上传文件](https://www.coze.cn/open/docs/developer_guides/upload_files)[查看文件详情](https://www.coze.cn/open/docs/developer_guides/retrieve_files)
智能音视频
ASR、TTS 与音色
[查看音色列表](https://www.coze.cn/open/docs/developer_guides/list_voices)[语音合成](https://www.coze.cn/open/docs/developer_guides/text_to_speech)[语音识别](https://www.coze.cn/open/docs/developer_guides/audio_transcriptions)[复刻音色](https://www.coze.cn/open/docs/developer_guides/clone_voices)
RTC 语音
[创建房间](https://www.coze.cn/open/docs/developer_guides/create_room)[Realtime 上行事件](https://www.coze.cn/open/docs/developer_guides/signaling_uplink_event)[Realtime 下行事件](https://www.coze.cn/open/docs/developer_guides/signaling_downlink_event)[Realtime 事件错误码](https://www.coze.cn/open/docs/developer_guides/realtime_error_codes)
WebSocket 语音
[双向流式语音识别](https://www.coze.cn/open/docs/developer_guides/asr_api)[双向流式语音识别事件](https://www.coze.cn/open/docs/developer_guides/asr_event)[双向流式语音合成](https://www.coze.cn/open/docs/developer_guides/tts_api)[双向流式语音合成事件](https://www.coze.cn/open/docs/developer_guides/tts_event)[双向流式语音对话](https://www.coze.cn/open/docs/developer_guides/streaming_chat_api)[双向流式对话上行事件](https://www.coze.cn/open/docs/developer_guides/streaming_chat_event)[双向流式对话下行事件](https://www.coze.cn/open/docs/developer_guides/streaming_chat_downlink_event)
声纹识别
[创建声纹组](https://www.coze.cn/open/docs/developer_guides/create_voiceprint_group)[查询声纹组列表](https://www.coze.cn/open/docs/developer_guides/list_voiceprint_group)[更新声纹组信息](https://www.coze.cn/open/docs/developer_guides/update_voiceprint_group)[删除声纹组](https://www.coze.cn/open/docs/developer_guides/delete_voiceprint_group)[创建声纹](https://www.coze.cn/open/docs/developer_guides/create_voiceprint)[更新声纹](https://www.coze.cn/open/docs/developer_guides/update_voiceprint)[查询声纹列表](https://www.coze.cn/open/docs/developer_guides/list_voiceprint)[删除声纹](https://www.coze.cn/open/docs/developer_guides/delete_voiceprint)[声纹特征比对](https://www.coze.cn/open/docs/developer_guides/identify_voiceprint)
知识库
[创建知识库](https://www.coze.cn/open/docs/developer_guides/create_dataset)[查看知识库列表](https://www.coze.cn/open/docs/developer_guides/list_dataset)[修改知识库信息](https://www.coze.cn/open/docs/developer_guides/update_dataset)[删除知识库](https://www.coze.cn/open/docs/developer_guides/delete_dataset)[创建知识库文件](https://www.coze.cn/open/docs/developer_guides/create_knowledge_files)[修改知识库文件](https://www.coze.cn/open/docs/developer_guides/modify_knowledge_files)[查看知识库文件列表](https://www.coze.cn/open/docs/developer_guides/list_knowledge_files)[查看知识库文件上传进度](https://www.coze.cn/open/docs/developer_guides/get_dataset_progress)[更新知识库图片描述](https://www.coze.cn/open/docs/developer_guides/update_image_caption)[查看知识库图片列表](https://www.coze.cn/open/docs/developer_guides/get_images)[删除知识库文件](https://www.coze.cn/open/docs/developer_guides/delete_knowdge_files)
插件
[查询付费插件列表](https://www.coze.cn/open/docs/developer_guides/list_plugin)[查询插件分类](https://www.coze.cn/open/docs/developer_guides/list_plugin_category)[查询插件详情](https://www.coze.cn/open/docs/developer_guides/get_plugin)[批量查询插件信息](https://www.coze.cn/open/docs/developer_guides/batch_get_plugins_info)[调用插件工具](https://www.coze.cn/open/docs/developer_guides/call_plugin_tool)[申请插件扩容回调事件](https://www.coze.cn/open/docs/developer_guides/benefit_plugin_scale_requested)[插件扩容到期回调事件](https://www.coze.cn/open/docs/developer_guides/benefit_plugin_scale_expired)
变量
[设置用户变量的值](https://www.coze.cn/open/docs/developer_guides/update_variable)[获取用户变量的值](https://www.coze.cn/open/docs/developer_guides/read_variable)
渠道
[更新审核结果](https://www.coze.cn/open/docs/developer_guides/update_review_result)[添加发布平台](https://www.coze.cn/open/docs/developer_guides/install_channel)[绑定设备](https://www.coze.cn/open/docs/developer_guides/bind_connector_config)
终端用户配额管控
[创建终端用户权益额度](https://www.coze.cn/open/docs/developer_guides/create_device_quotas)[查询终端用户的权益配额](https://www.coze.cn/open/docs/developer_guides/get_device_quotas)[更新终端用户的权益额度](https://www.coze.cn/open/docs/developer_guides/update_device_quotas)
账单与权益
[导出终端用户账单](https://www.coze.cn/open/docs/developer_guides/create_bill_task)[查询账单文件](https://www.coze.cn/open/docs/developer_guides/billing_file)[查询套餐权益](https://www.coze.cn/open/docs/developer_guides/get_benefit)[账单推送回调事件](https://www.coze.cn/open/docs/developer_guides/billing_callback_message)
回调
[创建回调应用](https://www.coze.cn/open/docs/developer_guides/create_callback_app)[修改回调应用](https://www.coze.cn/open/docs/developer_guides/update_callback_app)[查询回调应用列表](https://www.coze.cn/open/docs/developer_guides/list_callback_app)[删除回调应用](https://www.coze.cn/open/docs/developer_guides/delete_callback_app)[订阅回调事件](https://www.coze.cn/open/docs/developer_guides/subscribe_callback_message)[查询已订阅的事件](https://www.coze.cn/open/docs/developer_guides/list_subscribed_callback_message)[取消订阅事件](https://www.coze.cn/open/docs/developer_guides/unsubscribe_callback_message)
历史版本接口
[【Deprecated】查看已发布智能体列表](https://www.coze.cn/open/docs/developer_guides/published_bots_list)[【Deprecated】获取已发布智能体的配置](https://www.coze.cn/open/docs/developer_guides/get_metadata)
[错误码](https://www.coze.cn/open/docs/developer_guides/coze_error_codes)[API 常见问题](https://www.coze.cn/open/docs/developer_guides/api_faq)[模型能力差异](https://www.coze.cn/open/docs/developer_guides/model_api_param_support)
最佳实践
[通过对话接口获取智能体回复](https://www.coze.cn/open/docs/developer_guides/get_chat_response)[错误码 4100/4101 问题排查](https://www.coze.cn/open/docs/developer_guides/troubleshooting_4100_4101)[如何实现会话隔离](https://www.coze.cn/open/docs/developer_guides/session_isolation)[升级企业/团队版后更新 API 授权](https://www.coze.cn/open/docs/developer_guides/update_authorization)
SDK 参考
Chat SDK
[Chat SDK 概述](https://www.coze.cn/open/docs/developer_guides/web_sdk_overview)[安装并使用 Chat SDK](https://www.coze.cn/open/docs/developer_guides/install_web_sdk)[Chat SDK 发布历史](https://www.coze.cn/open/docs/developer_guides/web_sdk_changelog)[（历史版本）Chat SDK](https://www.coze.cn/open/docs/developer_guides/web_sdk)[Chat SDK 常见问题](https://www.coze.cn/open/docs/developer_guides/chat_sdk_faq)
Python SDK
[Python SDK 概述](https://www.coze.cn/open/docs/developer_guides/python_overview)[安装 Python SDK](https://www.coze.cn/open/docs/developer_guides/python_installation)[配置访问密钥](https://www.coze.cn/open/docs/developer_guides/python_access_token)[快速开始](https://www.coze.cn/open/docs/developer_guides/python_getting_started)
Node.js SDK
[Node.js SDK 概述](https://www.coze.cn/open/docs/developer_guides/nodejs_overview)[安装 Node.js SDK](https://www.coze.cn/open/docs/developer_guides/nodejs_install)[配置访问密钥](https://www.coze.cn/open/docs/developer_guides/nodejs_access_token)[快速开始](https://www.coze.cn/open/docs/developer_guides/nodejs_getting_started)
Java SDK
[Java SDK 概述](https://www.coze.cn/open/docs/developer_guides/java_overview)[安装 Java SDK](https://www.coze.cn/open/docs/developer_guides/java_installation)[配置访问密钥](https://www.coze.cn/open/docs/developer_guides/java_access_token)[快速开始](https://www.coze.cn/open/docs/developer_guides/java_getting_started)
Go SDK
[Go SDK 概述](https://www.coze.cn/open/docs/developer_guides/go_overview)[安装 Go SDK](https://www.coze.cn/open/docs/developer_guides/go_installation)[配置访问密钥](https://www.coze.cn/open/docs/developer_guides/go_access_token)[快速开始](https://www.coze.cn/open/docs/developer_guides/go_getting_started)
Web SDK
[安装并使用 Web SDK](https://www.coze.cn/open/docs/developer_guides/ui_builder_web_sdk)
Card SDK
[安装并使用 Card SDK](https://www.coze.cn/open/docs/developer_guides/card_sdk)
[实践教程](https://www.coze.cn/open/docs/tutorial)
[扣子空间](https://www.coze.cn/open/docs/cozespace)
[扣子罗盘](https://www.coze.cn/open/docs/cozeloop)
[客户案例](https://www.coze.cn/open/docs/customers)
[定价与购买](https://www.coze.cn/open/docs/coze_pro)
目录
大纲
升级企业/团队版后更新 API 授权
从专业版、个人进阶版升级至企业/团队版后，往往需要将已创建的工作空间迁移到新的企业/团队中，以便原有的智能体和扣子应用使用企业/团队版的高级权益。如果你待迁移的智能体、扣子应用或工作流已发布到 API 渠道，直接迁移工作空间会导致原有的 API 授权失效，线上用户调用 API 时会因鉴权失败而无法正常访问。​
在这种场景下，企业/团队的超级管理员需要在迁移工作空间之前，先修改业务代码中的鉴权部分，添加新老授权的兼容逻辑，保障平滑迁移，过程线上无感知。​
说明
从团队版升级至企业版时，无需迁移工作空间。​
​
迁移 API 授权​
注意事项​
​
注意事项​| 说明​  
---|---  
操作时段​| 如果智能体、应用或工作流已发布到生产环境、线上用户量较大，为了保障平滑迁移，建议选择服务流量较少的时段执行本步骤，例如深夜或凌晨时段。​  
权限设置​| 
  * 请确保已覆盖原授权的所有权限点，以免因权限不足导致 API 访问失败。​


  * 操作时，访问空间建议选择所有工作空间，确保空间迁移后访问令牌能访问该企业或团队中的所有空间，包括后续创建的新空间。​

  
API 方式创建会话​| 由于智能体等资源属于空间，API 方式创建的会话属于扣子用户，迁移空间之后，智能体无权限访问原个人账号下的会话，建议开发者创建新会话。创建方式可参考​创建会话。​  
原 OAuth 应用​| 请勿禁用或删除参考本文档完成改造的个人版 OAuth 应用，否则会影响在企业团队中的 OpenAPI 访问。​  
​
步骤一：确定授权类型​
扣子提供了个人访问令牌、OBO 等多种授权类型，各种授权类型下，更新 API 授权的方式不同。你需要先确定自己的授权方式。​
不同的扣子 OAuth 授权对应的授权类型和适用的客户端类型如下表所示。​
​
授权类型​| 授权方式​| 客户端类型​  
---|---|---  
个人访问令牌​| ​添加个人访问令牌​| 无​  
OBO 授权​| ​OAuth 授权码授权​| Web 后端应用​  
​| ​OAuth PKCE​| 移动端/PC 桌面端/单页面应用​  
​| ​OAuth 设备授权​| TV 端/设备应用/类命令行程序​  
AppAuth 授权​| ​OAuth JWT 授权（开发者）​| 服务类应用​  
​
步骤二：更新 API 授权​
AppAuth 授权场景​
AppAuth 授权是指应用以自身身份去访问扣子平台的资源。例如，一个后端服务需要从扣子平台获取数据。​
1 重新授权 OAuth 应用​
企业团队的超级管理员或管理员在企业团队版下完成对待迁移的 OAuth 应用的授权。​
1.
创建 OAuth 应用的扣子用户切换到个人版，并访问扣子 API ＞ OAuth 应用页面。​


2.
找到待迁移的 OAuth 应用，并在操作列单击分享图标。​


  * ​
​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27631%27%20height=%27302%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjMxIiBoZWlnaHQ9IjMwMiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​
​


3.
将复制好的链接发送给企业团队的超级管理员或管理员，由其打开链接完成授权。​


  * 授权相关的设置方式如下：​


  * 授权范围选择企业​


  * 工作空间选择所有工作空间​


  * ​
​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27585%27%20height=%27292%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTg1IiBoZWlnaHQ9IjI5MiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​
​


4.
确认授权成功。​


  * 企业团队的超级管理员或管理员切换到企业团队中。在左侧导航栏单击企业/团队 API，访问应用安装管理页面，确认授权成功。​


  * ​
​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27686%27%20height=%27374%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjg2IiBoZWlnaHQ9IjM3NCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​
​


2 更新授权代码​
应用程序在请求 OpenAPI 时，需要同时获取个人版和企业版下的授权凭证，默认先基于个人版的凭证访问资源，如果返回请求无权限（4100 和 4101） 或资源不存在的错误码，则再次基于企业版的凭证访问资源。​
1.
获取授权代码中需要填写的个人账号 UID 和企业 ID。​


  * ​
账号​| 获取方式​| 示例​  
---|---|---  
个人账号 UID​（personalAccountId）​| 必须是创建 OAuth 应用的扣子账号 UID。​在扣子平台左下角单击个人头像，并选择账号设置，在账号页面中查看 UID。​​| ​​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27317%27%20height=%27183%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzE3IiBoZWlnaHQ9IjE4MyIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​​  
企业 ID​（enterpriseAccountId）​| 切换到企业中，并在左侧导航栏中单击企业管理，URL 中 enterprise 参数后的数字就是 enterpriseAccountId。例如，在 URL https://www.coze.cn/enterprise/volcano_2105850***/enterprise/workspace中，volcano_2105850*** 就是 enterpriseAccountId。​| ​​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27252%27%20height=%27193%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUyIiBoZWlnaHQ9IjE5MyIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​​  
​


2.
更新授权代码。​


  * 以聊天接口为例，Go 语言代码改造方式如下，注意其中高亮部分：​


  * ​
Go
复制
package main ​
​
import ( ​
"context" ​
"errors" ​
"fmt" ​
"github.com/coze-dev/coze-go" ​
"os" ​
) ​
​
func main() { ​
// The default access is api.coze.com, but if you need to access api.coze.cn, ​
// please use base_url to configure the api endpoint to access ​
cozeAPIBase := os.Getenv("COZE_API_BASE") ​
jwtOauthClientID := os.Getenv("COZE_JWT_OAUTH_CLIENT_ID") ​
jwtOauthPrivateKey := os.Getenv("COZE_JWT_OAUTH_PRIVATE_KEY") ​
jwtOauthPrivateKeyFilePath := os.Getenv("COZE_JWT_OAUTH_PRIVATE_KEY_FILE_PATH") ​
jwtOauthPublicKeyID := os.Getenv("COZE_JWT_OAUTH_PUBLIC_KEY_ID") ​
botID := os.Getenv("PUBLISHED_BOT_ID") ​
uid := os.Getenv("USER_ID") ​
​
// Read private key from file ​
privateKeyBytes, err := os.ReadFile(jwtOauthPrivateKeyFilePath) ​
if err != nil { ​
fmt.Printf("Error reading private key file: %v\n", err) ​
return ​
} ​
jwtOauthPrivateKey = string(privateKeyBytes) ​
​
oauth, err := coze.NewJWTOAuthClient(coze.NewJWTOAuthClientParam{ ​
ClientID: jwtOauthClientID, PublicKey: jwtOauthPublicKeyID, PrivateKeyPEM: jwtOauthPrivateKey, ​
}, coze.WithAuthBaseURL(cozeAPIBase)) ​
if err != nil { ​
fmt.Printf("Error creating JWT OAuth client: %v\n", err) ​
return ​
} ​
ctx := context.Background() ​
​
var personalAccountId int64 = 12345 // 个人版 账号 UID​
var enterpriseAccountId int64 = 23456 // 企业版 账号 ID​
​
// 获取个人版下的访问凭证​
cozeCli := coze.NewCozeAPI(coze.NewJWTAuth(oauth, &coze.GetJWTAccessTokenReq{ ​
AccountID: &personalAccountId,​
}), coze.WithBaseURL(cozeAPIBase)) ​
// 获取企业版下的访问凭证​
cozeCli4Enterprise := coze.NewCozeAPI(coze.NewJWTAuth(oauth, &coze.GetJWTAccessTokenReq{​
EnterpriseID: &enterpriseAccountId,​
}), coze.WithBaseURL(cozeAPIBase))​
​
req := &coze.CreateChatsReq{ ​
BotID: botID, ​
UserID: uid, ​
Messages: []*coze.Message{ ​
coze.BuildUserQuestionText("What can you do?", nil), ​
}, ​
} ​
​
// 先尝试通过个人版的凭证请求chat接口​
resp, err := cozeCli.Chat.Create(ctx, req) ​
if err == nil { ​
fmt.Println(resp) ​
return ​
} ​
// 当请求个人版接口出现鉴权失败时, 再尝试基于企业版的凭证请求chat接口​
cozeErr := coze.Error{}​
if errors.As(err, &cozeErr) {​
// no permission error code​
if cozeErr.Code == 4101 || cozeErr.Code == 4100 {​
// no permission try chat with enterprise account​
resp, err = cozeCli4Enterprise.Chat.Create(ctx, req)​
if err == nil {​
fmt.Println(resp)​
return​
}​
}​
}​
fmt.Println(err) ​
} ​
​


3.
验证授权逻辑。​


  * 修改授权相关代码之后，建议确认代码中增加的逻辑准确、有效。例如在企业中新建空间和智能体，使用更新后的授权代码访问新智能体，对齐接口能力，验证通过之后再迁移工作空间。​


3 迁移工作空间到企业团队​
操作步骤可参考​迁移空间到团队或企业。成功迁移之后，后端服务如果使用旧的凭证请求扣子 OpenAPI，鉴权失败之后会自动切换为新的凭证，保证线上访问无影响。​
个人访问令牌场景​
如果你通过个人访问令牌来请求扣子 OpenAPI，那么可以创建新的个人访问令牌，并在代码中添加兼容逻辑。即在授权代码中同时添加旧的个人访问令牌和新的个人访问令牌，如果调用扣子 Open API 鉴权失败，则使用扣子企业版或团队版中的个人访问令牌。​
详细操作步骤如下：​
1 创建新的个人访问令牌​
1.
企业超级管理员或管理员切换到企业团队中。​


2.
从左侧导航栏访问企业/团队 API ＞ 个人访问令牌页面。​


3.
在页面右上角单击创建访问令牌。注意新令牌设置为企业团队内所有工作空间有效。​


  * ​
​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27499%27%20height=%27256%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDk5IiBoZWlnaHQ9IjI1NiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​
​


2 更新授权代码​
在授权代码中添加旧的个人访问令牌和新的个人访问令牌，如果使用旧令牌调用扣子 Open API 鉴权失败，则自动切换为企业团队空间的新令牌。​
修改授权相关代码之后，建议确认代码中增加的逻辑准确、有效。例如在企业中新建空间和智能体，使用更新后的授权代码访问新智能体，对齐接口能力，验证通过之后再迁移工作空间。​
Go 语言代码示例如下，其中高亮部分为新增内容。​
​
Go
复制
package main​
​
import (​
"context"​
"errors"​
"fmt"​
"os"​
​
"github.com/coze-dev/coze-go"​
)​
​
// How to use personal access token to init Coze client.​
//​
// Firstly, you need to access https://www.coze.com/open/oauth/pats (for the cn environment,​
// visit https://www.coze.cn/open/oauth/pats).​
//​
// Click to add a new token. After setting the appropriate name, expiration time, and​
// permissions, click OK to generate your personal access token. Please store it in a​
// secure environment to prevent this personal access token from being disclosed.​
func main() {​
cozeAPIToken := os.Getenv("COZE_API_TOKEN")​
cozeAPIToken4Enterprise := os.Getenv("COZE_API_TOKEN_ENTERPRISE")​
​
//​
// The default access is api.coze.com, but if you need to access api.coze.cn,​
// please use base_url to configure the api endpoint to access​
//​
cozeAPIBase := os.Getenv("COZE_API_BASE")​
​
ctx := context.Background()​
//​
// The Coze SDK offers the TokenAuth class for constructing an Auth class based on a fixed​
// access token. Meanwhile, the Coze class enables the passing in of an Auth class to build​
// a coze client.​
//​
// Therefore, you can utilize the following code to initialize a coze client.​
//​
​
cozeCli := coze.NewCozeAPI(coze.NewTokenAuth(cozeAPIToken), coze.WithBaseURL(cozeAPIBase))​
cozeCli4Enterprise := coze.NewCozeAPI(coze.NewTokenAuth(cozeAPIToken4Enterprise), coze.WithBaseURL(cozeAPIBase))​
​
// Try chat with the bot under your personal account​
resp, err := cozeCli.Chat.Create(ctx, &coze.CreateChatsReq{​
// your chat request params​
})​
if err == nil {​
fmt.Println(resp)​
return​
}​
// Retry chat with the bot under your enterprise account​
cozeErr := coze.Error{}​
if errors.As(err, &cozeErr) {​
// Authentication or Authorization Deny​
if cozeErr.Code == 4100 || cozeErr.Code == 4101 {​
resp, err = cozeCli4Enterprise.Chat.Create(ctx, &coze.CreateChatsReq{​
// your chat request params​
})​
if err == nil {​
fmt.Println(resp)​
return​
}​
}​
}​
fmt.Println(err)​
}​
​
3 迁移工作空间到企业团队​
操作步骤可参考​迁移空间到团队或企业。成功迁移之后，后端服务如果使用旧的个人访问密钥请求扣子 OpenAPI，鉴权失败之后会自动切换为新的密钥，保证线上访问无影响。​
说明
  * 建议仅在测试环境、调试场景中使用个人访问令牌，并严格限制其使用范围和有效期，生产环境中建议避免使用个人访问令牌。​


  * 迁移成功且验证 API 访问正常之后，建议及时删除旧的个人访问令牌，以免令牌到期后无法访问。​


​
OBO 授权场景​
OBO （On Behalf Of）授权是指应用以用户的身份去访问扣子平台的资源。例如，在 Web 后端应用、TV 端/设备应用/类命令行程序、移动端/PC 桌面端/单页面应用中，应用获取授权后，以用户的身份调用扣子平台的 API。​
在 OBO 授权场景中，开发者需要添加授权失败场景的处理策略，即鉴权失败时重新触发授权，获取新的 Access Token。​
1 更新授权代码​
修改业务代码，设置后端服务在鉴权失败时重新触发授权，获取新的 Access Token。​
修改授权相关代码之后，建议确认代码中增加的逻辑准确、有效。例如在企业中新建空间和智能体，使用更新后的授权代码访问新智能体，对齐接口能力，验证通过之后再迁移工作空间。​
本文以 Go 语言 OAuth 授权码授权场景为例，具体实现请参考以下示例代码中高亮的部分。​
​
Go
复制
package main​
​
import (​
"context"​
"errors"​
"fmt"​
"net/http"​
"os"​
​
"github.com/coze-dev/coze-go"​
)​
​
// How to effectuate OpenAPI authorization through the OAuth authorization code method.​
//​
// Firstly, users need to access https://www.coze.com/open/oauth/apps. For the cn environment,​
// users need to access https://www.coze.cn/open/oauth/apps to create an OAuth App of the type​
// of Web application.​
// The specific creation process can be referred to in the document:​
// https://www.coze.com/docs/developer_guides/oauth_code. For the cn environment, it can be​
// accessed at https://www.coze.cn/docs/developer_guides/oauth_code.​
// After the creation is completed, the client ID, client secret, and redirect link, can be​
// obtained. For the client secret, users need to keep it securely to avoid leakage.​
​
func main() {​
redirectURI := os.Getenv("COZE_WEB_OAUTH_REDIRECT_URI")​
clientSecret := os.Getenv("COZE_WEB_OAUTH_CLIENT_SECRET")​
clientID := os.Getenv("COZE_WEB_OAUTH_CLIENT_ID")​
ctx := context.Background()​
​
// The default access is api.coze.com, but if you need to access api.coze.cn,​
// please use base_url to configure the api endpoint to access​
cozeAPIBase := os.Getenv("COZE_API_BASE")​
if cozeAPIBase == "" {​
cozeAPIBase = coze.ComBaseURL​
}​
​
// The sdk offers the WebOAuthClient class to establish an authorization for Web OAuth.​
// Firstly, it is required to initialize the WebOAuthApp with the client ID and client secret.​
oauth, err := coze.NewWebOAuthClient(clientID, clientSecret, coze.WithAuthBaseURL(cozeAPIBase))​
if err != nil {​
fmt.Printf("Failed to create OAuth client: %v\n", err)​
return​
}​
​
// Generate the authorization link and direct the user to open it.​
oauthURL := oauth.GetOAuthURL(ctx, &coze.GetWebOAuthURLReq{​
RedirectURI: redirectURI,​
State: "state",​
})​
fmt.Println(oauthURL)​
​
// The space permissions for which the Access Token is granted can be specified. As following codes:​
// oauthURL = oauth.GetOAuthURL(&coze.GetWebOAuthURLReq{​
// RedirectURI: redirectURI,​
// State: "state",​
// WorkspaceID: &workspaceID,​
// })​
// fmt.Println(oauthURL)​
​
// After the user clicks the authorization consent button, the coze web page will redirect​
// to the redirect address configured in the authorization link and carry the authorization​
// code and state parameters in the address via the query string.​
//​
// Get from the query of the redirect interface: query.get('code')​
code := "mock code"​
​
// After obtaining the code after redirection, the interface to exchange the code for a​
// token can be invoked to generate the coze access_token of the authorized user.​
resp, err := oauth.GetAccessToken(ctx, &coze.GetWebOAuthAccessTokenReq{​
Code: code,​
RedirectURI: redirectURI,​
})​
if err != nil {​
fmt.Printf("Failed to get access token: %v\n", err)​
return​
}​
fmt.Println(resp)​
​
// When the token expires, you can also refresh and re-obtain the token​
resp, err = oauth.RefreshToken(ctx, resp.RefreshToken)​
if err != nil {​
fmt.Printf("Failed to refresh token: %v\n", err)​
return​
}​
​
fmt.Printf("%+v\n", resp)​
​
// you can get request log by getLogID method​
fmt.Println(resp.LogID())​
​
// use the access token to init Coze client​
cozeCli := coze.NewCozeAPI(coze.NewTokenAuth(resp.AccessToken))​
_, err = cozeCli.Chat.Create(ctx, &coze.CreateChatsReq{​
// chat request params​
})​
if err != nil {​
cozeErr := coze.Error{}​
if errors.As(err, &cozeErr) {​
// no permission error code​
if cozeErr.Code == 4101 || cozeErr.Code == 4100 {​
// request user authorization agin​
// redirect to oauthURL​
// call http.Redirect(w, r, oauthURL, http.StatusFound)​
}​
}​
}​
_ = cozeCli​
}​
​
2 迁移工作空间到企业团队​
操作步骤可参考​迁移空间到团队或企业。​
3 重新触发授权​
企业的超级管理员或管理员登录应用触发授权，然后在扣子平台重新安装应用，安装的步骤请参见​OAuth 应用管理。​
​
​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27700%27%20height=%27206.35838150289018%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzAwIiBoZWlnaHQ9IjIwNi4zNTgzODE1MDI4OTAxOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​
​
步骤三：线上观测​
成功迁移工作空间之后，应实时监测线上服务的请求成功率，确保线上服务无异常。​
如果线上授权相关逻辑持续稳定运行，可以酌情考虑线下原授权代码，切换为新的授权凭证来访问扣子 OpenAPI。​
授权团队/企业访问个人账号资源​
购买扣子企业/团队版并完成个人工作空间迁移后，因会话、音色等账号级别的资源无法自动迁移，若希望让团队、企业下的访问令牌也能访问原个人空间中的账号级别的资源，超级管理员或管理员可以手动授权团队或企业版中的 Token 访问个人账号中的会话、音色等账号级资源。​
1.
超级管理员或管理员切换到企业团队账号，创建个人访问令牌或 Oauth 应用，并授予会话管理等账号层级的权限，具体操作步骤请参见​OAuth JWT 授权（开发者）和​添加个人访问令牌。​


  * ​
​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27350%27%20height=%27489.57055214723925%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzUwIiBoZWlnaHQ9IjQ4OS41NzA1NTIxNDcyMzkyNSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​
​


  * 说明
    * 仅支持 PAT 和 AppAuth 授权，不支持 OBO 授权。​
    * 仅支持授权账号层级的权限，不支持授权工作空间层级的权限，你可以在授权对话框的权限列表中查看该权限的层级属性。​
​


2.
超级管理员或管理员访问[个人账号资源授权](https://www.coze.cn/personal-account-permission)页面，可以查看本人创建的个人访问令牌，以及企业或团队中创建的所有 AppAuth。​


  * ​
​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27600%27%20height=%27231.31672597864767%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjIzMS4zMTY3MjU5Nzg2NDc2NyIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==)​
​


3.
单击操作列中的授权。​


  * 授权后，你可以使用该 Token 访问你个人账号下的账号级资源。​


​
上一篇
如何实现会话隔离
下一篇
Chat SDK 概述
迁移 API 授权
注意事项
步骤一：确定授权类型
步骤二：更新 API 授权
AppAuth 授权场景
1 重新授权 OAuth 应用
2 更新授权代码
3 迁移工作空间到企业团队
个人访问令牌场景
1 创建新的个人访问令牌
2 更新授权代码
3 迁移工作空间到企业团队
OBO 授权场景
1 更新授权代码
2 迁移工作空间到企业团队
3 重新触发授权
步骤三：线上观测
授权团队/企业访问个人账号资源
文档是否帮助到您？
有帮助无帮助
关闭
迁移 API 授权
注意事项
步骤一：确定授权类型
步骤二：更新 API 授权
AppAuth 授权场景
1 重新授权 OAuth 应用
2 更新授权代码
3 迁移工作空间到企业团队
个人访问令牌场景
1 创建新的个人访问令牌
2 更新授权代码
3 迁移工作空间到企业团队
OBO 授权场景
1 更新授权代码
2 迁移工作空间到企业团队
3 重新触发授权
步骤三：线上观测
授权团队/企业访问个人账号资源
![](https://bat.bing.com/action/0?ti=97151251&Ver=2&mid=0b810818-c846-4599-a6ba-225cb6f684e4&bo=1&sid=a6c3ee30d4c211f0966da1ab2d8de18c&vid=a6c3dd00d4c211f0a7ba75271dd5e1e5&vids=0&msclkid=N&uach=pv%3D19.0.0&pi=0&lg=zh-CN&sw=1280&sh=720&sc=24&nwd=1&tl=%E6%89%A3%E5%AD%90&kw=%E6%89%A3%E5%AD%90,%20Coze,%20AI%20Agent,%20%E6%99%BA%E8%83%BD%E5%8A%9E%E5%85%AC,%20%E5%8A%9E%E5%85%AC%E6%8F%90%E6%95%88,%20AI%E5%86%99%E4%BD%9C,%20PPT%E7%94%9F%E6%88%90,%20%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91,%20%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7&p=https%3A%2F%2Fwww.coze.cn%2Fopen%2Fdocs%2Fdeveloper_guides%2Fupdate_authorization&r=&lt=1000&mtp=10&evt=pageLoad&sv=2&cdb=AQAQ&rn=288394)
![](https://bat.bing.com/action/0?ti=97179855&Ver=2&mid=35a705a2-2a89-419e-83fa-2686a2aa64ef&bo=1&sid=a6c3ee30d4c211f0966da1ab2d8de18c&vid=a6c3dd00d4c211f0a7ba75271dd5e1e5&vids=0&msclkid=N&uach=pv%3D19.0.0&pi=0&lg=zh-CN&sw=1280&sh=720&sc=24&nwd=1&tl=%E6%96%87%E6%A1%A3%20-%20%E6%89%A3%E5%AD%90&kw=%E6%89%A3%E5%AD%90,%20Coze,%20AI%20Agent,%20%E6%99%BA%E8%83%BD%E5%8A%9E%E5%85%AC,%20%E5%8A%9E%E5%85%AC%E6%8F%90%E6%95%88,%20AI%E5%86%99%E4%BD%9C,%20PPT%E7%94%9F%E6%88%90,%20%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91,%20%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7&p=https%3A%2F%2Fwww.coze.cn%2Fopen%2Fdocs%2Fdeveloper_guides%2Fupdate_authorization&r=&lt=1000&mtp=10&evt=pageLoad&sv=2&cdb=AQAQ&rn=582475)
rangeDom