https://www.coze.cn/open/docs/developer_guides/workflow_chat

# 扣子
创建
[主页](https://www.coze.cn/sign)[项目开发](https://www.coze.cn/sign)[资源库](https://www.coze.cn/sign)[任务中心](https://www.coze.cn/sign)[效果评测](https://www.coze.cn/sign)[空间配置](https://www.coze.cn/sign)
[模板商店](https://www.coze.cn/sign)[插件商店](https://www.coze.cn/sign)[作品社区](https://www.coze.cn/sign)[API 管理](https://www.coze.cn/open/playground)[文档中心](https://www.coze.cn/open/docs/guides)
目录取消固定
[使用指南](https://www.coze.cn/open/docs/guides)
[开发指南](https://www.coze.cn/open/docs/dev_how_to_guides)
[API 和 SDK](https://www.coze.cn/open/docs/developer_guides)
API 参考
[API 介绍](https://www.coze.cn/open/docs/developer_guides/coze_api_overview)[更新日志](https://www.coze.cn/open/docs/developer_guides/changelog)[准备工作](https://www.coze.cn/open/docs/developer_guides/preparation)[API Playground](https://www.coze.cn/open/docs/developer_guides/api_playground)
鉴权
[鉴权方式概述](https://www.coze.cn/open/docs/developer_guides/authentication)[添加个人访问令牌](https://www.coze.cn/open/docs/developer_guides/pat)[添加服务访问令牌](https://www.coze.cn/open/docs/developer_guides/service_token)[OAuth 应用管理](https://www.coze.cn/open/docs/developer_guides/oauth_apps)[通过示例文件体验 OAuth 授权流程](https://www.coze.cn/open/docs/developer_guides/ouath_demo)[OAuth 授权码授权](https://www.coze.cn/open/docs/developer_guides/oauth_code)[OAuth PKCE](https://www.coze.cn/open/docs/developer_guides/oauth_pkce)[OAuth 设备授权](https://www.coze.cn/open/docs/developer_guides/oauth_device_code)[OAuth JWT 授权（开发者）](https://www.coze.cn/open/docs/developer_guides/oauth_jwt)[OAuth JWT 授权（渠道场景）](https://www.coze.cn/open/docs/developer_guides/oauth_jwt_channel)[OAuth JWT 授权（跨账号授权场景）](https://www.coze.cn/open/docs/developer_guides/oauth_jwt_collaborate)[OAuth JWT 授权（企业特权应用）](https://www.coze.cn/open/docs/developer_guides/oauth_jwt_privilege)[OAuth 授权（多人协作场景）](https://www.coze.cn/open/docs/developer_guides/oauth_collaborate)[鉴权常见问题](https://www.coze.cn/open/docs/developer_guides/authentication_faq)
智能体和应用
[创建智能体](https://www.coze.cn/open/docs/developer_guides/create_bot)[更新智能体](https://www.coze.cn/open/docs/developer_guides/update_bot)[发布智能体](https://www.coze.cn/open/docs/developer_guides/publish_bot)[查看智能体列表](https://www.coze.cn/open/docs/developer_guides/bots_list_draft_published)[查看智能体配置](https://www.coze.cn/open/docs/developer_guides/get_metadata_draft_published)[开启或关闭智能体多人协作](https://www.coze.cn/open/docs/developer_guides/switch_bot_develop_mode)[添加智能体的协作者](https://www.coze.cn/open/docs/developer_guides/add_bot_collaborator)[添加应用的协作者](https://www.coze.cn/open/docs/developer_guides/add_app_collaborator)[删除智能体的协作者](https://www.coze.cn/open/docs/developer_guides/remove_bot_collaborator)[删除应用的协作者](https://www.coze.cn/open/docs/developer_guides/remove_app_collaborator)[查看智能体版本列表](https://www.coze.cn/open/docs/developer_guides/list_bot_versions)[复制资源](https://www.coze.cn/open/docs/developer_guides/copy_resource_task)[查询资源复制的结果](https://www.coze.cn/open/docs/developer_guides/query_resource_copy_execution_result)[下架智能体](https://www.coze.cn/open/docs/developer_guides/unpublish_agent)[Bot object](https://www.coze.cn/open/docs/developer_guides/bot_object)[查看应用列表](https://www.coze.cn/open/docs/developer_guides/published_apps_list)[智能体发布回调事件](https://www.coze.cn/open/docs/developer_guides/agent_callback_messages)[智能体删除回调事件](https://www.coze.cn/open/docs/developer_guides/agent_delete_callback_messages)[智能体下架回调事件](https://www.coze.cn/open/docs/developer_guides/agent_unpublished_callback_messages)
工作空间
[创建工作空间](https://www.coze.cn/open/docs/developer_guides/create_workspace)[查看空间列表](https://www.coze.cn/open/docs/developer_guides/list_workspace)[修改工作空间基本信息](https://www.coze.cn/open/docs/developer_guides/update_workspace_info)[查看空间成员列表](https://www.coze.cn/open/docs/developer_guides/list_space_member)[批量邀请用户加入空间](https://www.coze.cn/open/docs/developer_guides/add_space_member)[批量移除空间中的用户](https://www.coze.cn/open/docs/developer_guides/remove_space_member)
文件夹
[查询文件夹列表](https://www.coze.cn/open/docs/developer_guides/workspace_list_folder)[查询文件夹详情](https://www.coze.cn/open/docs/developer_guides/workspace_read_folder)
企业/组织
[成员管理（火山 API）](https://www.coze.cn/open/docs/developer_guides/create_coze_user)[添加团队/企业成员](https://www.coze.cn/open/docs/developer_guides/add_enterprise_member)[修改企业员工的角色](https://www.coze.cn/open/docs/developer_guides/update_enterprise_people)[移除团队/企业成员](https://www.coze.cn/open/docs/developer_guides/remove_enterprise_member)[创建组织](https://www.coze.cn/open/docs/developer_guides/create_organization)[修改组织基本信息](https://www.coze.cn/open/docs/developer_guides/update_organization_info)[查询组织列表](https://www.coze.cn/open/docs/developer_guides/list_organization)[添加组织成员](https://www.coze.cn/open/docs/developer_guides/add_organization_people)[查询组织成员列表](https://www.coze.cn/open/docs/developer_guides/list_organization_people)[修改组织成员角色](https://www.coze.cn/open/docs/developer_guides/update_organization_people)[移除组织成员](https://www.coze.cn/open/docs/developer_guides/remove_organization_member)
会话与消息
[创建会话](https://www.coze.cn/open/docs/developer_guides/create_conversation)[查看会话信息](https://www.coze.cn/open/docs/developer_guides/retrieve_conversation)[查看会话列表](https://www.coze.cn/open/docs/developer_guides/list_conversations)[更新会话名称](https://www.coze.cn/open/docs/developer_guides/edit_conversation)[删除会话](https://www.coze.cn/open/docs/developer_guides/delete_conversation)[清除上下文](https://www.coze.cn/open/docs/developer_guides/clear_conversation_context)[创建消息](https://www.coze.cn/open/docs/developer_guides/create_message)[查看消息列表](https://www.coze.cn/open/docs/developer_guides/list_message)[查看消息详情](https://www.coze.cn/open/docs/developer_guides/retrieve_message)[修改消息](https://www.coze.cn/open/docs/developer_guides/modify_message)[删除消息](https://www.coze.cn/open/docs/developer_guides/delete_message)[消息 type 说明](https://www.coze.cn/open/docs/developer_guides/message_type)[提交消息评价](https://www.coze.cn/open/docs/developer_guides/message_feedback)[删除消息评价](https://www.coze.cn/open/docs/developer_guides/delete_message_feedback)
对话
[发起对话](https://www.coze.cn/open/docs/developer_guides/chat_v3)[查看对话详情](https://www.coze.cn/open/docs/developer_guides/retrieve_chat)[查看对话消息详情](https://www.coze.cn/open/docs/developer_guides/list_chat_messages)[提交工具执行结果](https://www.coze.cn/open/docs/developer_guides/chat_submit_tool_outputs)[取消进行中的对话](https://www.coze.cn/open/docs/developer_guides/chat_cancel)
工作流
[执行工作流](https://www.coze.cn/open/docs/developer_guides/workflow_run)[执行工作流（流式响应）](https://www.coze.cn/open/docs/developer_guides/workflow_stream_run)[恢复运行工作流（流式响应）](https://www.coze.cn/open/docs/developer_guides/workflow_resume)[恢复运行工作流](https://www.coze.cn/open/docs/developer_guides/resume_workflow)[查询工作流异步运行结果](https://www.coze.cn/open/docs/developer_guides/workflow_history)[执行对话流](https://www.coze.cn/open/docs/developer_guides/workflow_chat)[查询输出节点的执行结果](https://www.coze.cn/open/docs/developer_guides/get_node_execute_history_response)[查询工作流列表](https://www.coze.cn/open/docs/developer_guides/get_workflow_list)[查询工作流基本信息](https://www.coze.cn/open/docs/developer_guides/get_workflow_info)[查询工作流的版本列表](https://www.coze.cn/open/docs/developer_guides/list_workflow_version)[开启或关闭工作流多人协作](https://www.coze.cn/open/docs/developer_guides/switch_workflow_develop_mode)[添加工作流协作者](https://www.coze.cn/open/docs/developer_guides/add_workflow_collaborator)[删除工作流协作者](https://www.coze.cn/open/docs/developer_guides/remove_workflow_collaborator)
文件
[上传文件](https://www.coze.cn/open/docs/developer_guides/upload_files)[查看文件详情](https://www.coze.cn/open/docs/developer_guides/retrieve_files)
智能音视频
ASR、TTS 与音色
[查看音色列表](https://www.coze.cn/open/docs/developer_guides/list_voices)[语音合成](https://www.coze.cn/open/docs/developer_guides/text_to_speech)[语音识别](https://www.coze.cn/open/docs/developer_guides/audio_transcriptions)[复刻音色](https://www.coze.cn/open/docs/developer_guides/clone_voices)
RTC 语音
[创建房间](https://www.coze.cn/open/docs/developer_guides/create_room)[Realtime 上行事件](https://www.coze.cn/open/docs/developer_guides/signaling_uplink_event)[Realtime 下行事件](https://www.coze.cn/open/docs/developer_guides/signaling_downlink_event)[Realtime 事件错误码](https://www.coze.cn/open/docs/developer_guides/realtime_error_codes)
WebSocket 语音
[双向流式语音识别](https://www.coze.cn/open/docs/developer_guides/asr_api)[双向流式语音识别事件](https://www.coze.cn/open/docs/developer_guides/asr_event)[双向流式语音合成](https://www.coze.cn/open/docs/developer_guides/tts_api)[双向流式语音合成事件](https://www.coze.cn/open/docs/developer_guides/tts_event)[双向流式语音对话](https://www.coze.cn/open/docs/developer_guides/streaming_chat_api)[双向流式对话上行事件](https://www.coze.cn/open/docs/developer_guides/streaming_chat_event)[双向流式对话下行事件](https://www.coze.cn/open/docs/developer_guides/streaming_chat_downlink_event)
声纹识别
[创建声纹组](https://www.coze.cn/open/docs/developer_guides/create_voiceprint_group)[查询声纹组列表](https://www.coze.cn/open/docs/developer_guides/list_voiceprint_group)[更新声纹组信息](https://www.coze.cn/open/docs/developer_guides/update_voiceprint_group)[删除声纹组](https://www.coze.cn/open/docs/developer_guides/delete_voiceprint_group)[创建声纹](https://www.coze.cn/open/docs/developer_guides/create_voiceprint)[更新声纹](https://www.coze.cn/open/docs/developer_guides/update_voiceprint)[查询声纹列表](https://www.coze.cn/open/docs/developer_guides/list_voiceprint)[删除声纹](https://www.coze.cn/open/docs/developer_guides/delete_voiceprint)[声纹特征比对](https://www.coze.cn/open/docs/developer_guides/identify_voiceprint)
知识库
[创建知识库](https://www.coze.cn/open/docs/developer_guides/create_dataset)[查看知识库列表](https://www.coze.cn/open/docs/developer_guides/list_dataset)[修改知识库信息](https://www.coze.cn/open/docs/developer_guides/update_dataset)[删除知识库](https://www.coze.cn/open/docs/developer_guides/delete_dataset)[创建知识库文件](https://www.coze.cn/open/docs/developer_guides/create_knowledge_files)[修改知识库文件](https://www.coze.cn/open/docs/developer_guides/modify_knowledge_files)[查看知识库文件列表](https://www.coze.cn/open/docs/developer_guides/list_knowledge_files)[查看知识库文件上传进度](https://www.coze.cn/open/docs/developer_guides/get_dataset_progress)[更新知识库图片描述](https://www.coze.cn/open/docs/developer_guides/update_image_caption)[查看知识库图片列表](https://www.coze.cn/open/docs/developer_guides/get_images)[删除知识库文件](https://www.coze.cn/open/docs/developer_guides/delete_knowdge_files)
插件
[查询付费插件列表](https://www.coze.cn/open/docs/developer_guides/list_plugin)[查询插件分类](https://www.coze.cn/open/docs/developer_guides/list_plugin_category)[查询插件详情](https://www.coze.cn/open/docs/developer_guides/get_plugin)[批量查询插件信息](https://www.coze.cn/open/docs/developer_guides/batch_get_plugins_info)[调用插件工具](https://www.coze.cn/open/docs/developer_guides/call_plugin_tool)[申请插件扩容回调事件](https://www.coze.cn/open/docs/developer_guides/benefit_plugin_scale_requested)[插件扩容到期回调事件](https://www.coze.cn/open/docs/developer_guides/benefit_plugin_scale_expired)
变量
[设置用户变量的值](https://www.coze.cn/open/docs/developer_guides/update_variable)[获取用户变量的值](https://www.coze.cn/open/docs/developer_guides/read_variable)
渠道
[更新审核结果](https://www.coze.cn/open/docs/developer_guides/update_review_result)[添加发布平台](https://www.coze.cn/open/docs/developer_guides/install_channel)[绑定设备](https://www.coze.cn/open/docs/developer_guides/bind_connector_config)
终端用户配额管控
[创建终端用户权益额度](https://www.coze.cn/open/docs/developer_guides/create_device_quotas)[查询终端用户的权益配额](https://www.coze.cn/open/docs/developer_guides/get_device_quotas)[更新终端用户的权益额度](https://www.coze.cn/open/docs/developer_guides/update_device_quotas)
账单与权益
[导出终端用户账单](https://www.coze.cn/open/docs/developer_guides/create_bill_task)[查询账单文件](https://www.coze.cn/open/docs/developer_guides/billing_file)[查询套餐权益](https://www.coze.cn/open/docs/developer_guides/get_benefit)[账单推送回调事件](https://www.coze.cn/open/docs/developer_guides/billing_callback_message)
回调
[创建回调应用](https://www.coze.cn/open/docs/developer_guides/create_callback_app)[修改回调应用](https://www.coze.cn/open/docs/developer_guides/update_callback_app)[查询回调应用列表](https://www.coze.cn/open/docs/developer_guides/list_callback_app)[删除回调应用](https://www.coze.cn/open/docs/developer_guides/delete_callback_app)[订阅回调事件](https://www.coze.cn/open/docs/developer_guides/subscribe_callback_message)[查询已订阅的事件](https://www.coze.cn/open/docs/developer_guides/list_subscribed_callback_message)[取消订阅事件](https://www.coze.cn/open/docs/developer_guides/unsubscribe_callback_message)
历史版本接口
[【Deprecated】查看已发布智能体列表](https://www.coze.cn/open/docs/developer_guides/published_bots_list)[【Deprecated】获取已发布智能体的配置](https://www.coze.cn/open/docs/developer_guides/get_metadata)
[错误码](https://www.coze.cn/open/docs/developer_guides/coze_error_codes)[API 常见问题](https://www.coze.cn/open/docs/developer_guides/api_faq)[模型能力差异](https://www.coze.cn/open/docs/developer_guides/model_api_param_support)
最佳实践
[通过对话接口获取智能体回复](https://www.coze.cn/open/docs/developer_guides/get_chat_response)[错误码 4100/4101 问题排查](https://www.coze.cn/open/docs/developer_guides/troubleshooting_4100_4101)[如何实现会话隔离](https://www.coze.cn/open/docs/developer_guides/session_isolation)[升级企业/团队版后更新 API 授权](https://www.coze.cn/open/docs/developer_guides/update_authorization)
SDK 参考
Chat SDK
[Chat SDK 概述](https://www.coze.cn/open/docs/developer_guides/web_sdk_overview)[安装并使用 Chat SDK](https://www.coze.cn/open/docs/developer_guides/install_web_sdk)[Chat SDK 发布历史](https://www.coze.cn/open/docs/developer_guides/web_sdk_changelog)[（历史版本）Chat SDK](https://www.coze.cn/open/docs/developer_guides/web_sdk)[Chat SDK 常见问题](https://www.coze.cn/open/docs/developer_guides/chat_sdk_faq)
Python SDK
[Python SDK 概述](https://www.coze.cn/open/docs/developer_guides/python_overview)[安装 Python SDK](https://www.coze.cn/open/docs/developer_guides/python_installation)[配置访问密钥](https://www.coze.cn/open/docs/developer_guides/python_access_token)[快速开始](https://www.coze.cn/open/docs/developer_guides/python_getting_started)
Node.js SDK
[Node.js SDK 概述](https://www.coze.cn/open/docs/developer_guides/nodejs_overview)[安装 Node.js SDK](https://www.coze.cn/open/docs/developer_guides/nodejs_install)[配置访问密钥](https://www.coze.cn/open/docs/developer_guides/nodejs_access_token)[快速开始](https://www.coze.cn/open/docs/developer_guides/nodejs_getting_started)
Java SDK
[Java SDK 概述](https://www.coze.cn/open/docs/developer_guides/java_overview)[安装 Java SDK](https://www.coze.cn/open/docs/developer_guides/java_installation)[配置访问密钥](https://www.coze.cn/open/docs/developer_guides/java_access_token)[快速开始](https://www.coze.cn/open/docs/developer_guides/java_getting_started)
Go SDK
[Go SDK 概述](https://www.coze.cn/open/docs/developer_guides/go_overview)[安装 Go SDK](https://www.coze.cn/open/docs/developer_guides/go_installation)[配置访问密钥](https://www.coze.cn/open/docs/developer_guides/go_access_token)[快速开始](https://www.coze.cn/open/docs/developer_guides/go_getting_started)
Web SDK
[安装并使用 Web SDK](https://www.coze.cn/open/docs/developer_guides/ui_builder_web_sdk)
Card SDK
[安装并使用 Card SDK](https://www.coze.cn/open/docs/developer_guides/card_sdk)
[实践教程](https://www.coze.cn/open/docs/tutorial)
[扣子空间](https://www.coze.cn/open/docs/cozespace)
[扣子罗盘](https://www.coze.cn/open/docs/cozeloop)
[客户案例](https://www.coze.cn/open/docs/customers)
[定价与购买](https://www.coze.cn/open/docs/coze_pro)
目录
大纲
执行对话流
执行已发布的对话流。​
接口说明​
对话流是基于对话场景的特殊工作流，专门用于处理对话类请求。对话流通过对话的方式和用户交互，并完成复杂的业务逻辑。在应用中添加对话流，将对话中的用户指令拆分为一个个步骤节点，并为其设计用户界面，你可以搭建出适用于移动端或网页端的对话式 AI 应用，实现自动化、智能化的对话流程。关于对话流的详细说明可参考​工作流与对话流。​
此接口为流式响应模式，允许客户端在接收到完整的数据流之前就开始处理数据，例如在对话界面实时展示回复内容，减少客户端等待模型完整回复的时间。 ​
此接口支持包括问答节点、输入节点等可能导致对话中断的节点，对话中断时只需再次调用对话流，在 additional_messages 中指定输入内容，即可继续对话。​
说明
  * 如果对话流的输入中包含文件、图片等多模态内容，需要先上传多模态内容以获取文件 ID 或 URL 地址，再将其作为对话流的输入。上传方式包括：​


  * 调用[上传文件](https://www.coze.cn/open/docs/developer_guides/upload_files) API，获取文件 ID，将此 ID 作为对话流的输入。 ​


  * 上传到第三方存储工具中，并获取一个公开可访问的 URL 地址，将此 URL 作为对话流的输入。​


  * 调用接口后，你可以从响应的 Done 事件中获得 debug_url，访问链接即可通过可视化界面查看对话流的试运行过程，其中包含每个执行节点的输入输出等详细信息，帮助你在线调试或排障。debug_url 的访问有效期为 7 天，过期后将无法访问。​


​
此接口可用于调用空间资源库中的对话流，或扣子应用中的对话流。调用这两种对话流时，入参不同：​
​
入参​| 资源库对话流​| ​| 扣子应用对话流​  
---|---|---|---  
​| 在智能体中执行​| 在扣子应用中执行​| ​  
workflow_id​| 必选​| 必选​| 必选​  
app_id​| 不传​| 必选​| 必选​  
bot_id​| 必选​| 不传​| 不传​  
conversation_id​| 可选​| 可选​| 可选​  
​
限制说明​
  * 通过 API 方式执行对话流前，应确认此对话流已发布，执行从未发布过的对话流时会返回错误码 4200。如果是扣子应用中的对话流，应先发布扣子应用为 API 服务；如果是空间资源库中的对话流，应先在资源库中发布对话流。​


  * 此接口暂不支持异步运行。​


  * 对话流中不支持提交端插件结果。​


基础信息​
​
请求方式​| POST​  
---|---  
请求地址​| ​Plain Text复制https://api.coze.cn/v1/workflows/chat​​  
权限​| run​确保调用该接口使用的令牌开通了 run 权限，详细信息参考​鉴权方式概述。​  
接口说明​| 执行已发布的对话流。​  
​
请求参数​
Header​
​
参数​| 取值​| 说明​  
---|---|---  
Authorization​| Bearer $Access_Token​| 用于验证客户端身份的访问令牌。你可以在扣子平台中生成访问令牌，详细信息，参考​准备工作。​  
Content-Type​| application/json​| 解释请求正文的方式。​  
​
​
​
Body​
​
参数​| 类型​| 是否必选​| 示例​| 说明​  
---|---|---|---|---  
workflow_id​| String ​| 必选​| 73505836754923***​| 待执行的对话流 ID，此对话流应已发布。​进入对话流编排页面，在页面 URL 中，workflow 参数后的数字就是 Workflow ID。例如 https://www.coze.cn/work_flow?space_id=42463***&workflow_id=73505836754923***，Workflow ID 为 73505836754923***。​  
additional_messages ​ ​ ​| Array of additional_messages object ​ ​| 必选​ ​| [ { "role": "user", "content_type": "text", "content": "你好" } ]​| 对话中用户问题和历史消息。数组长度限制为 50，即最多传入 50 条消息。 ​
  * 你需要通过此字段传入本次对话中用户的问题，也就是对话流的输入参数 USER_INPUT 的值。​


  * 可以同时传入多条历史消息，也就是本次对话的上下文。多条消息应按对话顺序排列，最后一条消息应为 role=user 的记录，也就是本次对话中用户的问题；其他消息为历史消息。 ​

说明对话流执行到问答节点、输入节点等节点时可能导致对话中断，此时只需再次调用对话流，在 additional_messages 中指定输入内容即可继续对话。​​  
parameters​| map[String]any​| 必选​| {"image": "{\"file_id\":\"1122334455\"}","user_name":"George"}​| 设置对话流输入参数中的自定义参数。以 JSON 序列化字符串形式传入。你可以在指定对话流的编排页面查看自定义输入参数列表。​
  * 设置文件类型的自定义参数​


  * 如果对话流输入参数为 Image 等类型的文件，你可以传入文件 URL 或调用[上传文件](https://www.coze.cn/open/docs/developer_guides/upload_files) API 获取 file_id 后传入 file_id。示例：​


  * 上传文件并传入 file_id：​


  * 单个文件示例："parameters": { "image": "{\"file_id\":\"1122334455\"}" }​


  * 文件数组示例："parameters": { "image": [ "{\"file_id\":\"1122334455\"}" ] }。​


  * 传入文件 URL：“parameters” :{"input":"请总结图片内容", "image": "https://example.com/tos-cn-i-mdko3gqilj/example.png" } ​


  * 会话名称绑定​


  * 你可以通过输入参数中的 CONVERSATION_NAME 绑定对应的会话名称，对话流产生的消息将保存到该会话中。推荐使用 conversation_id 绑定会话。​


  * 生效范围：此设置仅对扣子应用中的对话流生效。对于资源库对话流，你需要同时传入 app_id 以关联一个扣子应用，该设置才会生效。​


  * 获取方法：你可以在应用编排页面的会话管理中查看会话名称，或通过工作流中的查询会话列表节点查询会话名称。​


  * ​​​![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27300%27%20height=%27392.3705722070845%27/%3e)![](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjM5Mi4zNzA1NzIyMDcwODQ1IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PC9zdmc+)​​

说明
  * 对话流的输入参数 USER_INPUT 应在 additional_messages 中传入，在 parameters 中的 USER_INPUT 不生效。​


  * 如果 parameters 中未指定 CONVERSATION_NAME 或自定义输入参数，则使用参数默认值运行对话流；如果指定了这些参数，则使用指定值。​

​  
app_id​| String​| 可选​| 744208683**​| 需要关联的扣子应用 ID。调用对话流时，必须指定 app_id 或 bot_id，便于模型调用智能体或应用的数据库、变量等数据处理问题。​进入应用开发界面，开发页面URL中的project-ide参数后的数字就是AppID，例如https://www.coze.cn/space/74421656*****/project-ide/744208683** ，扣子应用 ID 为744208683**。​说明运行扣子应用中的对话流时，app_id 必选。详细说明可参考​接口说明。​​  
bot_id​​| String ​​| 可选​​| 75049216555930****​| 需要关联的智能体 ID。 调用对话流时，必须指定 app_id 或 bot_id，便于模型调用智能体或应用的数据库、变量等数据处理问题。​进入智能体开发页面，开发页面 URL 中 bot 参数后的数字就是智能体 ID。例如https://www.coze.cn/space/73428668341****/bot/73428668*****，bot ID 为73428668*****。 ​说明运行资源库中的对话流时，根据对话流执行的位置（智能体或扣子应用）选择设置 bot_id 还是 app_id。详细说明可参考​接口说明。​​  
conversation_id​| String​| 可选​| 748348012449138****​| 对话流对应的会话 ID，对话流产生的消息会保存到此会话中。会话默认为开始节点设置的 CONVERSATION_NAME，也可以通过 conversation_id 参数指定会话。​说明
  * 指定 conversation_id 时，parameters 中设置的 CONVERSATION_NAME 不生效。​


  * 会话的创建者必须和执行对话流的用户一致，即 API 访问令牌的创建者一致，否则无法执行对话流。​


  * 会话与 app_id、渠道匹配，不同渠道的会话隔离。​


  * 指定 bot_id 时，如果没有传入 conversation_id ，扣子会创建一个新的 conversation_id。不支持同时指定 bot_id 和 app_id。详细说明可参考​接口说明。​

​  
ext​| Map[String][String]​​| 可选​| {"latitude":"39.9042","longitude":"116.4074","user_id":"123456789"}​| 用于指定一些额外的字段，以 Map[String][String] 格式传入。例如某些插件会隐式用到的经纬度等字段。​目前仅支持以下字段：​
  * latitude：String 类型，表示纬度。​


  * longitude：String 类型，表示经度。​


  * user_id：String 类型，表示用户 ID。​

  
workflow_version​​​| String​​| 可选​​| v0.0.5​| 对话流的版本号，仅当运行的对话流属于资源库对话流时有效。未指定版本号时默认执行最新版本的对话流。​​  
connector_id​| String​​| 可选​​| 1024​​| 渠道 ID，用于配置该对话流在什么渠道执行。​当智能体或扣子应用发布到某个渠道后，可以通过该参数指定对话流在对应的渠道执行。​扣子的渠道 ID 包括：​
  * 1024（默认值）：API 渠道。​


  * 999：Chat SDK。​


  * 998：WebSDK。​


  * 10000122：扣子商店。​


  * 10000113：微信客服。​


  * 10000120：微信服务号。​


  * 10000121：微信订阅号。​


  * 10000126：抖音小程序。​


  * 10000127：微信小程序。​


  * 10000011：飞书。​


  * 10000128：飞书多维表格。​


  * 10000117：掘金。​


  * 自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子左下角单击头像，在账号设置 > 发布渠道 > 企业自定义渠道管理页面查看渠道 ID。​

说明不同渠道的用户数据、会话记录等相互隔离，进行数据分析统计时，不支持跨渠道数据调用。​  
​
additional_messages object​
​
参数​| 类型​| 是否必选​| 示例​| 说明​  
---|---|---|---|---  
role​| String​| 必选​| user​| 发送这条消息的实体。取值：​
  * user：代表该条消息内容是用户发送的。​


  * assistant：代表该条消息内容是模型发送的。​

  
type​​| String​| 可选​​| question​| 消息类型。默认为 question。​
  * question：用户输入内容。​


  * answer：模型返回给用户的消息内容，支持增量返回。如果对话流绑定了输出节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。​


  * function_call：智能体对话过程中调用函数（function call）的中间结果。 ​


  * tool_response：调用工具 （function call）后返回的结果。​

  
content​| String​| 可选​| 北京今天的天气怎么样​| 消息的内容，仅支持纯文本。​如果需要通过输入节点输入消息，可通过如下两种格式：​
  * JSON 格式的键值对，例如：{"input":"北京今天的天气怎么样"}。​


  * 用\n分隔的键值对，例如：{key1:val1\nkey2:val2\nkey3:val3}。​

说明
  * 暂不支持在 content 中输入多模态（文本、图片、文件混合输入）、卡片等类型的内容。​


  * 如果需要传入图片、文件等多模态内容，你可以在 parameters 中传入对应的自定义参数及其值。​

​  
content_type​| String​| 可选​| text​| 消息内容的类型。​content_type 固定为 text，表示普通文本。​说明指定 content 时，应同时设置 content_type。 ​​  
meta_data​| Map ​| 可选​| {"key1":"value1", "key2":"value2"}​| 创建消息时的附加消息，获取消息时也会返回此附加消息。​自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。​  
​
返回参数​
流式响应允许客户端在接收到完整的数据流之前就开始处理数据，例如在对话界面实时展示回复内容，减少客户端等待模型完整回复的时间。 ​
流式响应的整体流程如下：​
流式响应流程
流式响应示例
​
Plain Text
复制
######### 整体概览 （chat, MESSAGE 两级） ​
# chat - 开始​
# chat - 处理中 ​
# MESSAGE - 知识库召回 ​
# MESSAGE - function_call ​
# MESSAGE - tool_output ​
# MESSAGE - answer is normal text ​
# MESSAGE - 多 answer 的情况下，会继续有 message.delta ​
# chat - 完成 ​
# 流结束 event: done ​
######### ​
​
​
返回的事件消息体结构如下：​
​
参数​| 类型​| 说明​  
---|---|---  
event​| String​| 当前流式返回的数据包事件。在流式响应中，服务端不会一次性发送所有数据，而是以数据流的形式逐条发送数据给客户端，数据流中包含对话过程中触发的各种事件（event），直至处理完毕或处理中断。处理结束后，服务端会通过 conversation.message.completed 事件返回拼接后完整的模型回复信息。各个事件的说明可参考下表。 ​  
data​| Object​| 消息内容。其中，chat 事件和 message 事件的格式不同。​
  * chat 事件中，data 为 Chat Object。​


  * message 事件中，data 为 Message Object。​

  
​
流式响应事件列表：​
​
事件（event）名称​| 说明​  
---|---  
conversation.chat.created​| 创建对话的事件，表示对话开始。​  
conversation.chat.in_progress​| 服务端正在处理对话。​  
conversation.message.delta​| 增量消息，通常是 type=answer 时的增量消息。​  
conversation.message.completed​| message 已回复完成。此时流式包中带有所有 message.delta 的拼接结果，且每个消息均为 completed 状态。​  
conversation.chat.completed​| 对话完成。​  
conversation.chat.failed​| 此事件用于标识对话失败。​  
conversation.chat.requires_action​| 对话中断，需要使用方上报工具的执行结果。通常是触发了问答节点或输入节点，需要再次调用此接口继续对话。​  
error​| 流式响应过程中的错误事件。关于 code 和 msg 的详细说明，可参考​错误码。​  
done​| 本次会话的流式返回正常结束。​  
​
Chat Object​
​
参数​| 类型​| 是否可选​| 说明​  
---|---|---|---  
id​| String​| 必填​| 对话 ID，即对话的唯一标识。​  
conversation_id​| String​| 必填​| 会话 ID，即会话的唯一标识。​  
bot_id​| String​| 必填​| 要进行会话聊天的智能体 ID。​  
created_at​| Integer​| 选填​| 对话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。​  
completed_at​| Integer​| 选填​| 对话结束的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。​  
failed_at​| Integer​| 选填​| 对话失败的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。​  
meta_data​| Map<String,String>​| 选填​| 创建消息时的附加消息，用于传入使用方的自定义数据，获取消息时也会返回此附加消息。​自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。​  
last_error​​| Object​| 选填​| 对话运行异常时，此字段中返回详细的错误信息，包括：​
  * Code：错误码。Integer 类型。0 表示成功，其他值表示失败。​


  * Msg：错误信息。String 类型。​

说明
  * 对话正常运行时，此字段返回 null。​


  * suggestion 失败不会被标记为运行异常，不计入 last_error。​

​  
status​​| String​| 必填​| 对话的运行状态。取值为：​
  * created：对话已创建。​


  * in_progress：智能体正在处理中。​


  * completed：智能体已完成处理，本次对话结束。​


  * failed：对话失败。​


  * requires_action：对话中断，需要进一步处理。​


  * canceled：对话已取消。​

  
required_action​| Object​| 选填​| 需要运行的信息详情。​  
usage​| Object​| 选填​| Token 消耗的详细信息。实际的 Token 消耗以对话结束后返回的值为准。​  
»token_count​| Integer​| 选填​| 本次对话消耗的 Token 总数，包括 input 和 output 部分的消耗。​  
»output_count​| Integer​| 选填​| output 部分消耗的 Token 总数。​  
»input_count​| Integer​| 选填​| input 部分消耗的 Token 总数。​  
​
Chat Object 的示例如下：​
​
JSON
复制
{​
// 在 chat 事件里，data 字段中的 id 为 Chat ID，即会话 ID。​
"id": "737662389258662****",​
"conversation_id": "737554565555041****",​
"bot_id": "736661612448078****",​
"completed_at": 1717508113,​
"last_error": {​
"code": 0,​
"msg": ""​
},​
"status": "completed",​
"usage": {​
"token_count": 6644,​
"output_count": 766,​
"input_count": 5878​
}​
}​
​
Message Object​
​
参数​| 类型​| 说明​  
---|---|---  
id​| String​| Message ID，即消息的唯一标识。​  
conversation_id​| String​| 此消息所在的会话 ID。​  
bot_id​| String​| 编写此消息的智能体ID。此参数仅在对话产生的消息中返回。​  
chat_id​| String​| Chat ID。此参数仅在对话产生的消息中返回。​  
meta_data​| Map​| 创建消息时的附加消息，获取消息时也会返回此附加消息。​  
role​| String​| 发送这条消息的实体。取值：​
  * user：代表该条消息内容是用户发送的。​


  * assistant：代表该条消息内容是智能体发送的。​

  
content​| String​| 消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）等多种类型的内容。​  
content_type​| String​| 消息内容的类型，取值包括：​
  * text：文本。​


  * object_string：多模态内容，即文本和文件的组合、文本和图片的组合。​

  
created_at​| Integer​| 消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。​  
updated_at​| Integer​| 消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。​  
type​| String​| 消息类型。​
  * question：用户输入内容。​


  * answer：智能体返回给用户的消息内容，支持增量返回。如果对话流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。​


  * function_call：智能体对话过程中调用函数（function call）的中间结果。 ​


  * tool_response：调用工具 （function call）后返回的结果。​

  
section_id​| String​| 预留字段，仅在调用​发起对话 API 时的部分场景下返回，无需关注。​  
​
示例​
请求示例​
执行应用对话流
执行资源库对话流
执行扣子应用中的对话流时，需要通过 app_id 指定应用 ID。​
示例如下：​
​
Shell
复制
curl --location 'https://api.coze.cn/v1/workflows/chat' \​
\--header 'Authorization: Bearer pat_*****' \​
\--header 'Content-Type: application/json' \​
\--data '{​
"workflow_id": "74423***",​
"app_id": "7439828073***",​
"additional_messages": [​
{​
"role": "user",​
"content_type": "text",​
"content": "你好"​
}​
],​
"parameters": {​
"image":"{\"file_id\":\"1122334455\"}"​
}​
}'​
​
​
返回示例​
执行成功
执行失败
​
JSON
复制
# chat - 开始​
event: conversation.chat.created​
data: {"last_error":{"msg":"","code":0},"usage":{"token_count":0,"output_count":0,"input_count":0},"id":"75598600924738*****","conversation_id":"75598599835687*****","section_id":"75598599835687*****","status":"created","created_at":1760167093}​
# chat - 处理中​
event: conversation.chat.in_progress​
data: {"usage":{"token_count":0,"output_count":0,"input_count":0},"conversation_id":"75598599835687*****","id":"75598600924738*****","section_id":"75598599835687*****","last_error":{"code":0,"msg":""},"status":"in_progress","created_at":1760167093}​
​
event: conversation.message.delta​
data: {"conversation_id":"75598599835687*****","role":"assistant","section_id":"75598599835687*****","chat_id":"75598600924738*****","id":"75598601273532*****","type":"answer","content":"那我给你讲","content_type":"text"}​
​
event: conversation.message.delta​
data: {"content":"个会冒冷气的笑话哦！从前有只小企鹅问","content_type":"text","section_id":"75598599835687*****","conversation_id":"75598599835687*****","type":"answer","chat_id":"75598600924738*****","id":"75598601273532*****","role":"assistant"}​
​
event: conversation.message.delta​
data: {"id":"75598601273532*****","conversation_id":"75598599835687*****","role":"assistant","content_type":"text","chat_id":"75598600924738*****","type":"answer","content":"妈妈：\"为什么我们住在南极呀","section_id":"75598599835687*****"}​
​
event: conversation.message.delta​
data: {"content":"？\"妈妈摸着它的圆脑袋说","role":"assistant","conversation_id":"75598599835687*****","type":"answer","content_type":"text","chat_id":"75598600924738*****","section_id":"75598599835687*****","id":"75598601273532*****"}​
​
event: conversation.message.delta​
data: {"role":"assistant","type":"answer","chat_id":"75598600924738*****","section_id":"75598599835687*****","id":"75598601273532*****","conversation_id":"75598599835687*****","content":"：\"因为这里有好多好多鱼呀~\"小","content_type":"text"}​
​
event: conversation.message.delta​
data: {"role":"assistant","chat_id":"75598600924738*****","id":"75598601273532*****","conversation_id":"75598599835687*****","type":"answer","content":"企鹅眨巴眨巴眼睛：\"可是北极熊住在","content_type":"text","section_id":"75598599835687*****"}​
​
event: conversation.message.delta​
data: {"content":"北极也有鱼呀！\"妈妈突然把翅膀","chat_id":"75598600924738*****","section_id":"75598599835687*****","role":"assistant","type":"answer","content_type":"text","id":"75598601273532*****","conversation_id":"75598599835687*****"}​
​
event: conversation.message.delta​
data: {"id":"75598601273532*****","conversation_id":"75598599835687*****","role":"assistant","type":"answer","section_id":"75598599835687*****","content":"搭在它肩上，压低声音说","content_type":"text","chat_id":"75598600924738*****"}​
​
event: conversation.message.delta​
data: {"role":"assistant","type":"answer","content":"：\"傻孩子...因为如果我们搬到北极，就","content_type":"text","id":"75598601273532*****","conversation_id":"75598599835687*****","chat_id":"75598600924738*****","section_id":"75598599835687*****"}​
​
event: conversation.message.delta​
data: {"conversation_id":"75598599835687*****","role":"assistant","type":"answer","content_type":"text","section_id":"75598599835687*****","id":"75598601273532*****","content":"会变成'北极大企鹅啦！","chat_id":"75598600924738*****"}​
​
# MESSAGE - 消息结束​
event: conversation.message.completed​
data: {"chat_id":"75598600924738*****","created_at":1760167105,"id":"75598601273532*****","content":"那我给你讲个会冒冷气的笑话哦！从前有只小企鹅问妈妈：\"为什么我们住在南极呀？\"妈妈摸着它的圆脑袋说：\"因为这里有好多好多鱼呀~\"小企鹅眨巴眨巴眼睛：\"可是北极熊住在北极也有鱼呀！\"妈妈突然把翅膀搭在它肩上，压低声音说：\"傻孩子...因为如果我们搬到北极，就会变成'北极大企鹅'啦！\"","content_type":"text","section_id":"75598599835687*****","conversation_id":"75598599835687*****","role":"assistant","type":"answer"}​
​
event: conversation.message.completed​
data: {"updated_at":1760167107,"id":"75598601516393*****","role":"assistant","content_type":"text","chat_id":"75598600924738*****","created_at":1760167107,"conversation_id":"75598599835687*****","type":"verbose","content":"{\"msg_type\":\"empty result\",\"data\":\"empty result\",\"from_module\":null,\"from_unit\":null}","section_id":"75598599835687*****"}​
​
event: conversation.message.completed​
data: {"updated_at":1760167107,"id":"75598601569435*****","content":"{\"msg_type\":\"generate_answer_finish\",\"data\":\"{\\\\\"finish_reason\\\\\":0,\\\\\"FinData\\\\\":\\\\\"\\\\\"}\",\"from_module\":null,\"from_unit\":null}","content_type":"text","chat_id":"75598600924738*****","section_id":"75598599835687*****","created_at":1760167107,"conversation_id":"75598599835687*****","role":"assistant","type":"verbose"}​
# chat - 结束​
event: conversation.chat.completed​
data: {"status":"completed","usage":{"token_count":1736,"output_count":498,"input_count":1238},"created_at":1760167093,"id":"75598600924738*****","section_id":"75598599835687*****","completed_at":1760167107,"conversation_id":"75598599835687*****","last_error":{"code":0,"msg":""}}​
​
event: done​
data: {"debug_url":"https://www.coze.cn/work_flow?execute_id=75598600951038*****&space_id=74982048832804*****&workflow_id=75228046974940*****&execute_mode=2"}​
​
​
错误码​
如果成功调用扣子的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考​错误码文档查看对应的解决方法。​
​
​
上一篇
查询工作流异步运行结果
下一篇
查询输出节点的执行结果
接口说明
限制说明
基础信息
请求参数
Header
Body
additional_messages object
返回参数
Chat Object
Message Object
示例
请求示例
返回示例
错误码
文档是否帮助到您？
有帮助无帮助
关闭
接口说明
限制说明
基础信息
请求参数
Header
Body
additional_messages object
返回参数
Chat Object
Message Object
示例
请求示例
返回示例
错误码
![](https://bat.bing.com/action/0?ti=97151251&Ver=2&mid=1c6b7c3c-2970-48c0-8e6e-06c220155a0a&bo=1&sid=a6c3ee30d4c211f0966da1ab2d8de18c&vid=a6c3dd00d4c211f0a7ba75271dd5e1e5&vids=0&msclkid=N&uach=pv%3D19.0.0&pi=0&lg=zh-CN&sw=1280&sh=720&sc=24&nwd=1&tl=%E6%89%A3%E5%AD%90%20-%20AI%20Agent%E6%99%BA%E8%83%BD%E5%8A%9E%E5%85%AC%E5%B9%B3%E5%8F%B0%20-%20%E6%89%A3%E5%AD%90%E7%94%A8AI%E9%87%8D%E5%A1%91%E7%94%9F%E4%BA%A7%E5%8A%9B%E4%B8%8E%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87&kw=%E6%89%A3%E5%AD%90,%20Coze,%20AI%20Agent,%20%E6%99%BA%E8%83%BD%E5%8A%9E%E5%85%AC,%20%E5%8A%9E%E5%85%AC%E6%8F%90%E6%95%88,%20AI%E5%86%99%E4%BD%9C,%20PPT%E7%94%9F%E6%88%90,%20%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91,%20%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7&p=https%3A%2F%2Fwww.coze.cn%2Fopen%2Fdocs%2Fdeveloper_guides%2Fworkflow_chat&r=&mtp=10&evt=pageLoad&sv=2&cdb=AQAQ&rn=320869)
![](https://bat.bing.com/action/0?ti=97179855&Ver=2&mid=31c6e558-bcfb-44f9-b555-4d87a9d986a2&bo=1&sid=a6c3ee30d4c211f0966da1ab2d8de18c&vid=a6c3dd00d4c211f0a7ba75271dd5e1e5&vids=0&msclkid=N&uach=pv%3D19.0.0&pi=0&lg=zh-CN&sw=1280&sh=720&sc=24&nwd=1&tl=%E6%89%A3%E5%AD%90%20-%20AI%20Agent%E6%99%BA%E8%83%BD%E5%8A%9E%E5%85%AC%E5%B9%B3%E5%8F%B0%20-%20%E6%89%A3%E5%AD%90%E7%94%A8AI%E9%87%8D%E5%A1%91%E7%94%9F%E4%BA%A7%E5%8A%9B%E4%B8%8E%E5%B7%A5%E4%BD%9C%E6%95%88%E7%8E%87&kw=%E6%89%A3%E5%AD%90,%20Coze,%20AI%20Agent,%20%E6%99%BA%E8%83%BD%E5%8A%9E%E5%85%AC,%20%E5%8A%9E%E5%85%AC%E6%8F%90%E6%95%88,%20AI%E5%86%99%E4%BD%9C,%20PPT%E7%94%9F%E6%88%90,%20%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91,%20%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7&p=https%3A%2F%2Fwww.coze.cn%2Fopen%2Fdocs%2Fdeveloper_guides%2Fworkflow_chat&r=&mtp=10&evt=pageLoad&sv=2&cdb=AQAQ&rn=80835)
rangeDom